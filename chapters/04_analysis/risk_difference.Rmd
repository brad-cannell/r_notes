# Risk Difference

<!--
Risk difference may be too narrow for a chapter. At some point, I will probably change this note to measures of disease occurance. I just don't have time to do it tonight.
-->

```{r random-pic-from-url, echo=FALSE}
knitr::include_graphics("https://picsum.photos/200/300")
```

## ‚≠êÔ∏èOverview

This chapter is about calculating and interpreting risk differences.

Are a risk difference in an attributable risk the same thing? Yes, but attributable risk is an older term and it's use is discouraged. <https://sphweb.bumc.bu.edu/otlt/mph-modules/ep/ep713_association/ep713_association_print.html>

How do you interpret an attributable risk? <https://sphweb.bumc.bu.edu/otlt/mph-modules/ep/ep713_association/ep713_association_print.html>

## üåéUseful websites

* Then note on [Contingency Tables]

* [Boston University](https://sphweb.bumc.bu.edu/otlt/mph-modules/ep/ep713_association/ep713_association_print.html)

## üì¶Load packages

```{r message=FALSE}
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
```

Using an example from the [Boston University website](https://sphweb.bumc.bu.edu/otlt/mph-modules/ep/ep713_association/ep713_association_print.html):

Data Summary

Consider the following example regarding the management of Hodgkin lymphoma, a cancer of the lymphatic system. Years ago when a patient was diagnosed with Hodgkin Disease, they would frequently undergo a surgical procedure called a "staging laparotomy." The purpose of the staging laparotomy was to determine the extent to which the cancer had spread, because this was important information for determining the patient's prognosis and optimizing treatment. At times, the surgeons performing this procedure would also remove the patient's appendix, not because it was inflamed; it was done "incidentally" in order to ensure that the patient never had to worry about getting appendicitis. However, performing an appendectomy requires transecting it, and this has the potential to contaminate the abdomen and the wound edges with bacteria normally contained inside the appendix. Some surgeons felt that doing this "incidental appendectomy" did the patient a favor by ensuring that they would never get appendicitis, but others felt that it meant unnecessarily increasing the patient's risk of getting a post-operative wound infection by spreading around the bacteria that was once inside the appendix. To address this, the surgeons at a large hospital performed a retrospective cohort study. They began by going through the hospital's medical records to identify all subjects who had had a "staging laparotomy performed for Hodgkin." They then reviewed the medical record and looked at the operative report to determine whether the patient had an incidental appendectomy or not. They then reviewed the progress notes, the laboratory reports, the nurses notes, and the discharge summary to determine whether the patient had developed a wound infection during the week after surgery. The investigators reviewed the records of 210 patients who had undergone the staging procedure and found that 131 had also had an incidental appendectomy, while the other 79 had not. The data from that study are summarized in the table below. The numbers in the second and third columns indicate the number of subjects who did or did not develop a post-operative wound infection among those who had the incidental appendectomy (in the "Yes" row) and those who did not have the incidental appendectomy (in the "No" row). For example, the upper left cell indicates that seven of the subjects who had an incidental appendectomy (the exposure of interest) subsequently developed a wound infection. The upper right cell indicates that the other 124 subjects who had an incidental appendectomy did NOT develop a wound infection.

|                              |                 |                    |       |
|------------------------------|-----------------|--------------------|-------|
| Had incidental appendectomy? | Wound infection | No wound infection | Total |
| Yes                          | 7               | 124                | 131   |
| No                           | 1               | 78                 | 79    |
| Total                        | 8               | 202                | 210   |

## üî¢Simulate data

First, simulate the data as a 2x2 contingency table. Here, we will experiment with structuring the contingency table in a few different ways. 

### Simulate a matrix object



### Simulate a table object

```{r}

```


```{r}
crosstab <- as.table(crosstab_mat)

# Add margins
crosstab <- addmargins(crosstab)
crosstab
```

### Simulate a base R data frame

```{r}
crosstab_df <- as.data.frame(crosstab_mat)
crosstab_df
```

### Simulate a tibble

Unlike the other objects, this object won't have the standard contingency table layout. 

```{r}
tbl <- tribble(
  ~appendectomy, ~infection, ~count,
  "Yes", "Yes", 7,
  "Yes", "No",  124,
  "No",  "Yes", 1,
  "No",  "No",  78
)

# Add margins
tbl %>% 
  group_by(appendectomy) %>% 
  mutate(appendectomy_totals = sum(count)) %>% 
  group_by(infection) %>% 
  mutate(infection_totals = sum(count)) %>% 
  ungroup() %>% 
  mutate(margin_total = sum(count))
```

## üìàAnalysis

### Incidence proportion

Before calculating any other measures of occurrence, we first need to calculate the incidence proportion in each exposure group. 

#### Matrix

```{r}
crosstab_mat <- cbind(crosstab_mat, rowsum = rowSums(crosstab_mat))
crosstab_mat
```

```{r}
ip_mat <- crosstab_mat[, "Infection"] / crosstab_mat[, "rowsum"]
crosstab_mat <- cbind(crosstab_mat, ip_mat)
crosstab_mat
```

#### Table

```{r}
ip_tab <- crosstab[, "Infection"] / crosstab[, "Sum"]
crosstab <- cbind(crosstab, ip_tab)
crosstab
```

#### data frame

```{r}
crosstab_df <- crosstab_df %>% 
  mutate(
    rowsum = rowSums(crosstab_df),
    ip_df = `Infection` / rowsum
  )

crosstab_df
```

#### Tibble


### Risk Differences

Instead of comparing two measures of disease frequency by calculating their ratio, one can compare them in terms of their absolute difference. The risk difference is calculated by subtracting the cumulative incidence in the unexposed group (or least exposed group) from the cumulative incidence in the group with the exposure. 

$$ \text{Risk Difference (RD)} = CI_e - CI_u $$

where ($CI_e$) = cumulative incidence among the exposed subjects, and ($CI_u$) is the cumulative incidence among unexposed subjects.

The risk difference focuses on absolute effect of the risk factor, or the excess risk of disease in those who have the factor compared with those who don't. Recall that in the wound infection study, the cumulative incidence of infection was 5.3% in the incidental appendectomy group, and only 1.3% in the group without appendectomies. The risk ratio was 4.2, but we can also compute the absolute difference, which is 5.3 / 100 - 1.3 / 100 = 4 per 100 excess wound infections among those who had the incidental appendectomy. $CI_$u provides an estimate of the baseline risk (i.e., in the absence of the exposure), and the exposure factor imposes an additional (excess) risk on top of that.

<p class="note"> üóí**Side Note:** Modern Epidemiology 4th edition uses the term incience proportion instead of cumulative incidence. @Lash2021-rz </p>

```{r}
tibble(
  appendectomy = factor(c("No", "No", "Yes", "Yes")),
  base_rate = c("Yes", "No", "Yes", "No"),
  incidence = c(1.3, 0.0, 1.3, 4.0) 
) %>% 
ggplot() +
  geom_col(aes(x = appendectomy, y = incidence, fill = base_rate)) +
  scale_fill_manual(values = c("red", "gray")) +
  labs(
    x = "Had Incidental Appendectomy",
    y = "Wound Infection Incidence per 100"
  ) +
  theme_classic() +
  theme(legend.position = "none") 
```

<p class="note"> üóí**Side Note:** At some point, come back and annotate this to match the figure [here](https://sphweb.bumc.bu.edu/otlt/mph-modules/ep/ep713_association/ep713_association_print.html). You may also want to add this to the data visualization note. </p>

<!--
Clean up and add session info
-->

```{r echo=FALSE}
rm(list = ls())
```

```{r echo=FALSE}
sessionInfo()
```
