# Tables

<!--
Hidden comments placeholder
Left off working on the code chunk on line 172. It works, but we may want to break it into smaller code chunks to show how each section works. 
Then, continue moving code over from line 192 of table_use_app.Rmd
-->

```{r random-pic-from-url, echo=FALSE}
knitr::include_graphics("https://picsum.photos/200/300")
```

## ⭐️Overview

This chapter is about **formatting and presenting statistical results in tables.**

The immediate results of statistical analyses are rarely fit for general consumption. This chapter walks through strategies and functions we can use to make our results ready for presentation/dissemination.

Tables are one of the most popular ways to present information to our audience. When our goal is to show our readers precise numerical summaries of our data, the exact values that resulted from our analysis are important.

However, the specific details that we may want to present from table to table, or the way in which we want to present them, can vary widely. For example, an initial table of descriptive information about our participants may or may not be stratified by subgroups of interest. Additionally, it may include variables of different types, and for any given type, it may include various different kinds of numerical summaries. Further, there are numerous types of inferential models that result in numerical summaries that we may want to present in a table. For these reasons, it is difficult to create a good one-size-fits-all approach to automating the process of making results ready for presentation and dissemination.

Having said that, below we walk through some basic strategies for automating the processes of putting results into presentation-ready summary tables -- and in a way that makes updating them (which happens A LOT) as painless as possible.


## Projects to review and incorporate

stroke study -> table_characteristics_by_network.Rmd to see an example of doing this with purrr::map. When you have time, you should add an example into this document.

See Sun Study Report Template for a good example of automating this with Officer and Flextable.

I used a little different method in Link2Care > paper_smartphone_app > table_use_app.Rmd. Try to work some of that in below. 

/Users/bradcannell/Dropbox/01 Research/Elder Abuse/DETECT NIH RFA-AG-18-010/LEAD Panel/summarise_lead_votes/report_filemaker.Rmd

This chapter also kind of overlaps with the [Flexdashboard] and [Officer] chapters. At some point, I should think about the best way to link and organize the chapters. Another option is to put all the flextable stuff in this chapter. I might still want a separate chapter about officer. 


## 🌎Useful websites

* [Officer Word document generation](https://davidgohel.github.io/officer/articles/offcran/word.html)   
* [Flextable Overview](https://davidgohel.github.io/flextable/articles/overview.html)   
* [R gtsummary package](http://www.danieldsjoberg.com/gtsummary/)   


## 📦Load packages

```{r message=FALSE}
library(dplyr, warn.conflicts = FALSE)
library(DT)
library(freqtables)
library(tidyr)
library(purrr)
```


## 🔢Simulate data 

Have you noticed how we will often calculate the same statistical measures for many different variables in our data? For example, let’s say that we have some pretty standard data about some study participants that looks like this:

```{r}
study <- tibble(
  id        = 1:68,
  age       = c(32, 30, 32, 29, 24, 38, 25, 24, 48, 29, 22, 29, 24, 28, 24, 25, 
                25, 22, 25, 24, 25, 24, 23, 24, 31, 24, 29, 24, 22, 23, 26, 23, 
                24, 25, 24, 33, 27, 25, 26, 26, 26, 26, 26, 27, 24, 43, 25, 24, 
                27, 28, 29, 24, 26, 28, 25, 24, 26, 24, 26, 31, 24, 26, 31, 34, 
                26, 25, 27, 40),
  age_group = c(2, 2, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
                1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 
                1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 
                2, 1, 1, 1, 2),
  gender    = c(2, 1, 1, 2, 1, 1, 1, 2, 2, 2, 1, 1, 2, 1, 1, 1, 1, 2, 2, 1, 1, 
                1, 1, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 2, 2, 1, 2, 2, 1, 2, 2, 1, 
                1, 1, 1, 1, 1, 1, 1, 2, 2, 1, 1, 1, 1, 2, 2, 1, 1, 2, 1, 2, 1, 
                1, 1, 2, 1, 2),
  ht_in     = c(70, 63, 62, 67, 67, 58, 64, 69, 65, 68, 63, 68, 69, 66, 67, 65, 
                64, 75, 67, 63, 60, 67, 64, 73, 62, 69, 67, 62, 68, 66, 66, 62, 
                64, 68, NA, 68, 70, 68, 68, 66, 71, 61, 62, 64, 64, 63, 67, 66, 
                69, 76, NA, 63, 64, 65, 65, 71, 66, 65, 65, 71, 64, 71, 60, 62, 
                61, 69, 66, NA),
  wt_lbs    = c(216, 106, 145, 195, 143, 125, 138, 140, 158, 167, 145, 297, 146, 
                125, 111, 125, 130, 182, 170, 121, 98, 150, 132, 250, 137, 124, 
                186, 148, 134, 155, 122, 142, 110, 132, 188, 176, 188, 166, 136, 
                147, 178, 125, 102, 140, 139, 60, 147, 147, 141, 232, 186, 212, 
                110, 110, 115, 154, 140, 150, 130, NA, 171, 156, 92, 122, 102, 
                163, 141, NA),
  bmi       = c(30.99, 18.78, 26.52, 30.54, 22.39, 26.12, 23.69, 20.67, 26.29, 
                25.39, 25.68, 45.15, 21.56, 20.17, 17.38, 20.8, 22.31, 22.75, 
                26.62, 21.43, 19.14, 23.49, 22.66, 32.98, 25.05, 18.31, 29.13, 
                27.07, 20.37, 25.01, 19.69, 25.97, 18.88, 20.07, NA, 26.76, 
                26.97, 25.24, 20.68, 23.72, 24.82, 23.62, 18.65, 24.03, 23.86, 
                10.63, 23.02, 23.72, 20.82, 28.24, NA, 37.55, 18.88, 18.3, 
                19.13, 21.48, 22.59, 24.96, 21.63, NA, 29.35, 21.76, 17.97, 
                22.31, 19.27, 24.07, 22.76, NA),
  bmi_3cat  = c(3, 1, 2, 3, 1, 2, 1, 1, 2, 2, 2, 3, 1, 1, 1, 1, 1, 1, 2, 1, 1, 
                1, 1, 3, 2, 1, 2, 2, 1, 2, 1, 2, 1, 1, NA, 2, 2, 2, 1, 1, 1, 1, 
                1, 1, 1, 1, 1, 1, 1, 2, NA, 3, 1, 1, 1, 1, 1, 1, 1, NA, 2, 1, 
                1, 1, 1, 1, 1, NA)
) %>% 
# Create exposure and outcome where,
# Exposure is more likely in people over age 30 and 
# Outcome is more likely in peeople with exposure
mutate(
  exposure = if_else(
    age_group == 1, 
    sample(c(0,1), 68, TRUE, c(.9, .1)),
    sample(c(0,1), 68, TRUE, c(.7, .3))
  ),
  outcome = if_else(
    exposure == 1, 
    sample(c(0,1), 68, TRUE, c(.8, .2)),
    sample(c(0,1), 68, TRUE, c(.5, .5))
  )
) %>% 
# Make factors
mutate(
  age_group = factor(age_group, labels = c("Younger than 30", "30 and Older")),
  gender    = factor(gender, labels = c("Female", "Male")),
  bmi_3cat  = factor(bmi_3cat, labels = c("Normal", "Overweight", "Obese")),
  exposure  = factor(exposure, labels = c("No", "Yes")),
  outcome   = factor(outcome, labels = c("No", "Yes"))
)
```

```{r}
datatable(study, options = list(scrollX = TRUE))
```


## Example: Table 1

This first example is perhaps the most common type of table we will create -- a Table 1 -- or basic descriptive table about our participants. 

## 🔴 Come back and do this after the table is made in Word
Let's start by looking at a complete example: 

[Create a table 1 from the study data and insert a screen shot here]

After cleaning your data, which isn't covered in this chapter, a typical workflow for creating a Table 1 like this may look like the following:

### Outcome distribution

First, we typically want to see how many people have each value for the outcome of interest. Later, we will want to add these values to our table header as (N = XX).

```{r}
n_outcome <- study %>% 
  count(outcome) %>% 
  pull(n) %>%
  set_names(levels(study$outcome))

n_outcome
```

### Create helper functions

For calculating statistics of interest. 

**Note:** This chapter isn't about how to calculate or interpret all the various different statistics we may want to calculate from project to project. For more details on descriptve statistics see:

* [R4Epi Descriptive Analysis](https://www.r4epi.com/introduction-to-descriptive-analysis.html)    
* [meantables](placeholder)   
* [freqtables](placeholder)    

Of course, we don't have to create helper functions -- this step is totally optional -- but, it will make our code easier to maintain.

Typically, we will make one helper function for our continuous variables and one helper function for our categorical variables. We do this because the stats we want to calculate for continuous variables (e.g., mean) are almost always different than the stats we want to calculate for categorical variables (e.g., percentages).

#### Continuous stats function

Before we make our function, let's start by calculating our statistics of interest for a single variable.

```{r}
# For testing
study %>% 
  # Remove missing here so we don't have to add na.rm below
  filter(!is.na(age)) %>% 
  group_by(outcome) %>% 
  summarise(
    var = "age",
    mean = mean(age),
    sd = sd(age),
  ) %>% 
  freq_format("mean (sd)", digits = 1) %>% 
  # Currently, the  first column is named with the group_by variable.
  # We are changing the column name to group_cat to make it easier to row bind
  # later. 
  select(var, group_cat = 1, formatted_stats) %>% 
  tidyr::pivot_wider(
    names_from = "group_cat",
    values_from = "formatted_stats"
  ) %>% 
  # Add blank row below
  add_row(var = "", No = "", Yes = "")
```


<!--
Clean up and add session info
-->

# Stuff from 

```{r echo=FALSE}
rm(list = ls())
```

```{r echo=FALSE}
sessionInfo()
```



















