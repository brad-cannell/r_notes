# Git and GitHub

<!--
Hidden comments placeholder
-->

```{r echo=FALSE}
knitr::include_graphics("https://picsum.photos/200/300")
```

## ⭐️Overview

My notes on git and GitHub. There are also chapters in R4Epi on git and GitHub. These notes should not reproduce those chapter. These notes should go beyond those chapters or be used for experimenting. 

* [Coding best practices](https://www.r4epi.com/coding-best-practices.html). I still need to add material to this section about writing commit messages.      
* [Introduction to git and GitHub](https://www.r4epi.com/introduction-to-git-and-github.html)   
* [Using git and GitHub](https://www.r4epi.com/using-git-and-gitHub.html)   

This chapter of the notes still needs a ton of cleaning up!


## 🌎Useful websites

* [How to Use Git/GitHub with R](https://rfortherestofus.com/2021/02/how-to-use-git-github-with-r/)   
* [Git Book](https://git-scm.com/book/en/v2)   
* [Happy Git and GitHub for the useR](https://happygitwithr.com/)   
* [GitHub Hello World tutorial](https://docs.github.com/en/get-started/quickstart/hello-world)   
* [How to Write a Git Commit Message](https://cbea.ms/git-commit/)   
* [How to Write Better Git Commit Messages – A Step-By-Step Guide](https://www.freecodecamp.org/news/how-to-write-better-git-commit-messages/)   
* [How to Write Good Commit Messages: A Practical Git Guide](https://www.freecodecamp.org/news/writing-good-commit-messages-a-practical-guide/)


## Documenting practices

With GitHub, there are so many options for where and how we can document things. This is my current set of best practices.

* README: Getting started and _how_ to use for users.

* Vignettes: More depth than README and possibly talks about the theory behind the package/project. Possibly answers the _why_ questions. 

* Pgkdown: Not different from README and vignettes. Just makes them easier to find and look a little nicer.

* NOTES: My private notes just for me. Not for tasks. Answers _why_ or _how_, but not _what_. When possible, use Wiki instead.

* GitHub Wiki: Public notes for contributors/developers. 

* GitHub Discussion: Public questions and answers. I'm trying to decide if I should just use Stack Overflow somehow instead. Maybe use both.

* GitHub issues: Tasks that need to be completed.

* GitHub projects: Organize issues/tasks.


## Commit message

This section needs a ton of improvement -- and probably should be moved over to [Coding best practices](https://www.r4epi.com/coding-best-practices.html). However, I want to jot down some quick notes.

From, [How to Write a Git Commit Message](https://cbea.ms/git-commit/), I like:

> A properly formed Git commit subject line should always be able to complete the following sentence: If applied, this commit will {your subject line here}


## Get rid of .DS_Store

The `.DS_Store` file can be an annoyance when working with Git on MacOS. [Here is a link](https://stackoverflow.com/questions/107701/how-can-i-remove-ds-store-files-from-a-git-repository/107921) to instructions for removing `.DS_Store` from your repository. Do it early and never worry about it again. 

In the terminal, run the following code from the root directory:

```{bash eval=FALSE}
# Remove existing files from the repository:
find . -name "*.DS_Store" -type f -exec git-rm {} \;
```

```{bash eval=FALSE}
# Add .DS_Store to .gitignore
echo .DS_Store >> .gitignore
```

```{bash eval=FALSE}
# Commit the file to the repo
git add .gitignore
git commit -m '.DS_Store banished!'
```


## Amend

* Edit -> commit -> edit -> amend -> commit = no problem!   
* Edit -> commit -> push -> edit -> amend -> commit -> push  = problem!   
* [Short answer, don’t do it.](https://stackoverflow.com/questions/43289444/git-merge-conflict-after-git-amend-your-branch-and-origin-master-have-diver)     
* [Adding more chages to your last commit](https://medium.com/@igor_marques/git-basics-adding-more-changes-to-your-last-commit-1629344cb9a8)    

## Pull Requests

* [Instructions for leaving comments](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/reviewing-proposed-changes-in-a-pull-request)    
* Very simple merge conflicts can be resolved directly on GitHub.com    
* Use command line instructions to try out the code to resolve more complex merge conflicts.    

Example command line pull request merge conflict
```{r echo=FALSE}
knitr::include_graphics("img/08_collaborating/git_merge_conflict.png")
```

If there are already changes on the branch (so you can’t pull), you need to either:    

* Commit the changes on the branch (if you want to keep them)    
* Throw away local changes with git checkout -f, and then remove untracked files with git clean -fd    

## Branches

Naming convention:
issue-#-short-description

Basic workflow:

1. Create new branch - never develop on Master   
2. Push new branch to remote   
3. Do some work - commit - amend - push along the way    
4. When work is done, create a pull request for Master    
5. Deal with merge conflicts if they exist, and merge into Master    
6. Delete development branch    

[Merging specific files from another branch.](https://jasonrudolph.com/blog/2009/02/25/git-tip-how-to-merge-specific-files-from-another-branch/)

Also, if you haven’t committed the files you don’t want to move over yet:

* Commit just the files you DO want to merge into master.    
* Push    
* Create a request to pull the changes you just committed into the master branch.     
* Don’t delete the issue branch. Just continue working on the files you don’t commit and merge with the pull request.    


## Squashing commits

I've done more of this lately. These notes should be improved too. For now, I just want to jot down that **The first commit message will be the commit message for the squashed commits**. So, if you know you are doing some WIP commits, you may want to start with the end in mind?

You can also [amend your commit message](https://www.gitkraken.com/learn/git/problems/git-commit-amend) in GitKraken, but this is complicated if you've already pushed to a remote repository. 


## Other littl quirks and errors

When working on Epi III -- and I think this could be an issue with using git on OneDrive more generally -- I would have to recommit files when I changed computers. Not because the **content** of the file had changed, but because something called the **file mode** had changed. I searched SO and seemed to fix it with this post: https://stackoverflow.com/questions/1580596/how-do-i-make-git-ignore-file-mode-chmod-changes

Open terminal and type:

```{bash eval=FALSE}
git config core.fileMode false
```

Another issue I encountered when working on Epi III -- and I think this could be an issue with using git on OneDrive more generally -- was the existence of these "Icon" files every time I switched computers. However, they didn't seem to actually exist (or at least they weren't visible), and ignoring them in the usual way did not seem to _actually_ ignore them. I searched SO and seemed to fix it with this post: https://stackoverflow.com/questions/17556250/how-to-ignore-icon-in-git

Open terminal and type:

```{bash eval=FALSE}
printf "Icon\r\r" >> .gitignore
```


<!--
Clean up and add session info
-->

```{r echo=FALSE}
rm(list = ls())
```


