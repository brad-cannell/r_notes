<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Tidy Evaluation | R Notes</title>
  <meta name="description" content="This is the Bookdown for Brad Cannellâ€™s R Notes." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Tidy Evaluation | R Notes" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://brad-cannell.github.io/r_notes/" />
  
  <meta property="og:description" content="This is the Bookdown for Brad Cannellâ€™s R Notes." />
  <meta name="github-repo" content="brad-cannell/r_notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Tidy Evaluation | R Notes" />
  
  <meta name="twitter:description" content="This is the Bookdown for Brad Cannellâ€™s R Notes." />
  

<meta name="author" content="Brad Cannell" />


<meta name="date" content="2022-05-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="creating-rmd-templates.html"/>
<link rel="next" href="arranging-columns-with-across.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.20/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i>Organization</a></li>
</ul></li>
<li class="part"><span><b>I Programming</b></span></li>
<li class="chapter" data-level="1" data-path="my-package-notes.html"><a href="my-package-notes.html"><i class="fa fa-check"></i><b>1</b> Packages: Quick Start</a>
<ul>
<li class="chapter" data-level="1.1" data-path="my-package-notes.html"><a href="my-package-notes.html#overview"><i class="fa fa-check"></i><b>1.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="1.2" data-path="my-package-notes.html"><a href="my-package-notes.html#useful-websites"><i class="fa fa-check"></i><b>1.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="1.3" data-path="my-package-notes.html"><a href="my-package-notes.html#quick-process"><i class="fa fa-check"></i><b>1.3</b> Quick Process</a></li>
<li class="chapter" data-level="1.4" data-path="my-package-notes.html"><a href="my-package-notes.html#before-creating-the-package"><i class="fa fa-check"></i><b>1.4</b> Before creating the package</a></li>
<li class="chapter" data-level="1.5" data-path="my-package-notes.html"><a href="my-package-notes.html#create"><i class="fa fa-check"></i><b>1.5</b> Step 1: Create the package project</a></li>
<li class="chapter" data-level="1.6" data-path="my-package-notes.html"><a href="my-package-notes.html#notes"><i class="fa fa-check"></i><b>1.6</b> Step 2: Add a NOTES file</a></li>
<li class="chapter" data-level="1.7" data-path="my-package-notes.html"><a href="my-package-notes.html#license"><i class="fa fa-check"></i><b>1.7</b> Step 3: Add license</a></li>
<li class="chapter" data-level="1.8" data-path="my-package-notes.html"><a href="my-package-notes.html#modify"><i class="fa fa-check"></i><b>1.8</b> Step 4: Modify the description file</a></li>
<li class="chapter" data-level="1.9" data-path="my-package-notes.html"><a href="my-package-notes.html#readme"><i class="fa fa-check"></i><b>1.9</b> Step 5: Add README</a></li>
<li class="chapter" data-level="1.10" data-path="my-package-notes.html"><a href="my-package-notes.html#git"><i class="fa fa-check"></i><b>1.10</b> Step 6: Add Git</a></li>
<li class="chapter" data-level="1.11" data-path="my-package-notes.html"><a href="my-package-notes.html#github"><i class="fa fa-check"></i><b>1.11</b> Step 7: Connect to GitHub</a></li>
<li class="chapter" data-level="1.12" data-path="my-package-notes.html"><a href="my-package-notes.html#package-functions"><i class="fa fa-check"></i><b>1.12</b> Step 8: Adding content to the package</a>
<ul>
<li class="chapter" data-level="1.12.1" data-path="my-package-notes.html"><a href="my-package-notes.html#working-with-r-scripts"><i class="fa fa-check"></i><b>1.12.1</b> Working with R scripts</a></li>
<li class="chapter" data-level="1.12.2" data-path="my-package-notes.html"><a href="my-package-notes.html#adding-help-pages-to-functions"><i class="fa fa-check"></i><b>1.12.2</b> Adding help pages to functions</a></li>
<li class="chapter" data-level="1.12.3" data-path="my-package-notes.html"><a href="my-package-notes.html#example-roxygen-header"><i class="fa fa-check"></i><b>1.12.3</b> Example <code>roxygen</code> header</a></li>
<li class="chapter" data-level="1.12.4" data-path="my-package-notes.html"><a href="my-package-notes.html#dont-run-the-examples"><i class="fa fa-check"></i><b>1.12.4</b> Donâ€™t run the examples</a></li>
<li class="chapter" data-level="1.12.5" data-path="my-package-notes.html"><a href="my-package-notes.html#keyboard-shortcut-for-inserting-roxygen-comment"><i class="fa fa-check"></i><b>1.12.5</b> Keyboard shortcut for inserting roxygen #â€™ comment</a></li>
<li class="chapter" data-level="1.12.6" data-path="my-package-notes.html"><a href="my-package-notes.html#simulating-data"><i class="fa fa-check"></i><b>1.12.6</b> Simulating data</a></li>
<li class="chapter" data-level="1.12.7" data-path="my-package-notes.html"><a href="my-package-notes.html#documenting-data"><i class="fa fa-check"></i><b>1.12.7</b> Documenting data</a></li>
<li class="chapter" data-level="1.12.8" data-path="my-package-notes.html"><a href="my-package-notes.html#documenting-package"><i class="fa fa-check"></i><b>1.12.8</b> Documenting Package</a></li>
</ul></li>
<li class="chapter" data-level="1.13" data-path="my-package-notes.html"><a href="my-package-notes.html#testing"><i class="fa fa-check"></i><b>1.13</b> Step 9: Creating unit tests</a></li>
<li class="chapter" data-level="1.14" data-path="my-package-notes.html"><a href="my-package-notes.html#vignettes"><i class="fa fa-check"></i><b>1.14</b> Step 10: Vignettes</a>
<ul>
<li class="chapter" data-level="1.14.1" data-path="my-package-notes.html"><a href="my-package-notes.html#to-create-a-vignette"><i class="fa fa-check"></i><b>1.14.1</b> To create a vignette:</a></li>
<li class="chapter" data-level="1.14.2" data-path="my-package-notes.html"><a href="my-package-notes.html#vignette-notes"><i class="fa fa-check"></i><b>1.14.2</b> Vignette Notes:</a></li>
<li class="chapter" data-level="1.14.3" data-path="my-package-notes.html"><a href="my-package-notes.html#pkgdown"><i class="fa fa-check"></i><b>1.14.3</b> Pkgdown</a></li>
</ul></li>
<li class="chapter" data-level="1.15" data-path="my-package-notes.html"><a href="my-package-notes.html#cran"><i class="fa fa-check"></i><b>1.15</b> Submitting to CRAN</a></li>
<li class="chapter" data-level="1.16" data-path="my-package-notes.html"><a href="my-package-notes.html#other-random-notes"><i class="fa fa-check"></i><b>1.16</b> Other random notes</a>
<ul>
<li class="chapter" data-level="1.16.1" data-path="my-package-notes.html"><a href="my-package-notes.html#get-rid-of-.ds_store"><i class="fa fa-check"></i><b>1.16.1</b> Get rid of .DS_Store</a></li>
</ul></li>
<li class="chapter" data-level="1.17" data-path="my-package-notes.html"><a href="my-package-notes.html#errors-warnings-notes"><i class="fa fa-check"></i><b>1.17</b> Errors, warnings, notes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="creating-rmd-templates.html"><a href="creating-rmd-templates.html"><i class="fa fa-check"></i><b>2</b> Creating Rmd Templates</a>
<ul>
<li class="chapter" data-level="2.1" data-path="creating-rmd-templates.html"><a href="creating-rmd-templates.html#overview-1"><i class="fa fa-check"></i><b>2.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="2.2" data-path="creating-rmd-templates.html"><a href="creating-rmd-templates.html#useful-websites-1"><i class="fa fa-check"></i><b>2.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="2.3" data-path="creating-rmd-templates.html"><a href="creating-rmd-templates.html#create-a-package"><i class="fa fa-check"></i><b>2.3</b> Create a package</a></li>
<li class="chapter" data-level="2.4" data-path="creating-rmd-templates.html"><a href="creating-rmd-templates.html#add-a-template-to-your-package"><i class="fa fa-check"></i><b>2.4</b> Add a template to your package</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html"><i class="fa fa-check"></i><b>3</b> Tidy Evaluation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#overview-2"><i class="fa fa-check"></i><b>3.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="3.2" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#useful-websites-2"><i class="fa fa-check"></i><b>3.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="3.3" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#load-packages"><i class="fa fa-check"></i><b>3.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="3.4" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#simulate-data"><i class="fa fa-check"></i><b>3.4</b> ğŸ”¢Simulate data</a></li>
<li class="chapter" data-level="3.5" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#load-starwars-data"><i class="fa fa-check"></i><b>3.5</b> Load Starwars data</a></li>
<li class="chapter" data-level="3.6" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#why-use-tidy-evaluation"><i class="fa fa-check"></i><b>3.6</b> Why use tidy evaluation?</a></li>
<li class="chapter" data-level="3.7" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#what-is-tidy-evaluation"><i class="fa fa-check"></i><b>3.7</b> What is tidy evaluation?</a></li>
<li class="chapter" data-level="3.8" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#vocabulary"><i class="fa fa-check"></i><b>3.8</b> Vocabulary</a></li>
<li class="chapter" data-level="3.9" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#key_functions"><i class="fa fa-check"></i><b>3.9</b> Key Functions</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-qq_show-function"><i class="fa fa-check"></i><b>3.9.1</b> The qq_show function</a></li>
<li class="chapter" data-level="3.9.2" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-quo-function"><i class="fa fa-check"></i><b>3.9.2</b> The quo function</a></li>
<li class="chapter" data-level="3.9.3" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-enquo-function"><i class="fa fa-check"></i><b>3.9.3</b> The enquo function</a></li>
<li class="chapter" data-level="3.9.4" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-embrace-operator"><i class="fa fa-check"></i><b>3.9.4</b> The embrace operator</a></li>
<li class="chapter" data-level="3.9.5" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-quos-function"><i class="fa fa-check"></i><b>3.9.5</b> The quos function</a></li>
<li class="chapter" data-level="3.9.6" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#enquos"><i class="fa fa-check"></i><b>3.9.6</b> The enquos function</a></li>
<li class="chapter" data-level="3.9.7" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-as_label-and-as_name-functions"><i class="fa fa-check"></i><b>3.9.7</b> The as_label and as_name functions</a></li>
<li class="chapter" data-level="3.9.8" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-sym-function"><i class="fa fa-check"></i><b>3.9.8</b> The sym function</a></li>
<li class="chapter" data-level="3.9.9" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-syms-function"><i class="fa fa-check"></i><b>3.9.9</b> The syms function</a></li>
<li class="chapter" data-level="3.9.10" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#the-rlang-prounouns"><i class="fa fa-check"></i><b>3.9.10</b> The rlang prounouns</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#for_loop"><i class="fa fa-check"></i><b>3.10</b> Example: for Loop</a></li>
<li class="chapter" data-level="3.11" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#functions"><i class="fa fa-check"></i><b>3.11</b> Example: function</a></li>
<li class="chapter" data-level="3.12" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#nesting"><i class="fa fa-check"></i><b>3.12</b> Nesting functions with data masking</a></li>
<li class="chapter" data-level="3.13" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#purrr"><i class="fa fa-check"></i><b>3.13</b> Using purrr</a></li>
<li class="chapter" data-level="3.14" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#quirks"><i class="fa fa-check"></i><b>3.14</b> Other Quirks and Lessons Learned</a>
<ul>
<li class="chapter" data-level="3.14.1" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#when-doesnt-work"><i class="fa fa-check"></i><b>3.14.1</b> When !! doesnâ€™t work</a></li>
<li class="chapter" data-level="3.14.2" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#unquoting-inside-non-dplyr-functions"><i class="fa fa-check"></i><b>3.14.2</b> Unquoting inside non-dplyr functions</a></li>
<li class="chapter" data-level="3.14.3" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#using-a-quoture-to-create-variable-name-in-mutate"><i class="fa fa-check"></i><b>3.14.3</b> Using a quoture to create variable name in mutate</a></li>
<li class="chapter" data-level="3.14.4" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#using-a-quoture-to-turn-a-variable-name-into-a-constant-value"><i class="fa fa-check"></i><b>3.14.4</b> Using a quoture to turn a variable name into a constant value</a></li>
<li class="chapter" data-level="3.14.5" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#convert-a-string-to-a-quoture"><i class="fa fa-check"></i><b>3.14.5</b> Convert a string to a quoture</a></li>
</ul></li>
<li class="chapter" data-level="3.15" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html#example-i-created-for-steph-yap"><i class="fa fa-check"></i><b>3.15</b> Example I created for Steph Yap</a></li>
</ul></li>
<li class="part"><span><b>II Working with External Files</b></span></li>
<li class="part"><span><b>III Data Management</b></span></li>
<li class="chapter" data-level="4" data-path="arranging-columns-with-across.html"><a href="arranging-columns-with-across.html"><i class="fa fa-check"></i><b>4</b> Arranging Columns with Across</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arranging-columns-with-across.html"><a href="arranging-columns-with-across.html#solution-by-lmc"><i class="fa fa-check"></i><b>4.1</b> Solution by LMc:</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html"><i class="fa fa-check"></i><b>5</b> Column Names: Prepping Many for Merge</a>
<ul>
<li class="chapter" data-level="5.1" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#overview-3"><i class="fa fa-check"></i><b>5.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="5.2" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#useful-websites-3"><i class="fa fa-check"></i><b>5.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="5.3" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#load-packages-1"><i class="fa fa-check"></i><b>5.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="5.4" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#simulate-data-1"><i class="fa fa-check"></i><b>5.4</b> ğŸ”¢Simulate data</a></li>
<li class="chapter" data-level="5.5" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#get-the-existing-column-names"><i class="fa fa-check"></i><b>5.5</b> Get the existing column names</a></li>
<li class="chapter" data-level="5.6" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#standardize-new-column-names"><i class="fa fa-check"></i><b>5.6</b> Standardize new column names</a></li>
<li class="chapter" data-level="5.7" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#turn-this-into-a-function"><i class="fa fa-check"></i><b>5.7</b> Turn this into a function</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#make-a-unit-test-for-the-function"><i class="fa fa-check"></i><b>5.7.1</b> Make a unit test for the function</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#manual-changes-to-column-names"><i class="fa fa-check"></i><b>5.8</b> Manual changes to column names</a></li>
<li class="chapter" data-level="5.9" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#have-r-write-out-the-rename-code"><i class="fa fa-check"></i><b>5.9</b> Have R write out the rename code</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#make-it-a-function"><i class="fa fa-check"></i><b>5.9.1</b> Make it a function</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#rename-the-columns"><i class="fa fa-check"></i><b>5.10</b> Rename the columns</a></li>
<li class="chapter" data-level="5.11" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#repeat-the-process-for-v2"><i class="fa fa-check"></i><b>5.11</b> Repeat the process for V2</a></li>
<li class="chapter" data-level="5.12" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#repeat-the-process-for-v3"><i class="fa fa-check"></i><b>5.12</b> Repeat the process for V3</a></li>
<li class="chapter" data-level="5.13" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#merge-all-3-visits"><i class="fa fa-check"></i><b>5.13</b> Merge all 3 visits</a></li>
<li class="chapter" data-level="5.14" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#final-data-cleaning"><i class="fa fa-check"></i><b>5.14</b> Final data cleaning</a></li>
<li class="chapter" data-level="5.15" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#the-dplyr-way"><i class="fa fa-check"></i><b>5.15</b> ğŸŸ£The dplyr way</a>
<ul>
<li class="chapter" data-level="5.15.1" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#standardize-new-column-names-1"><i class="fa fa-check"></i><b>5.15.1</b> Standardize new column names</a></li>
<li class="chapter" data-level="5.15.2" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#manual-changes-to-column-names-1"><i class="fa fa-check"></i><b>5.15.2</b> Manual changes to column names 1</a></li>
<li class="chapter" data-level="5.15.3" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#merge-all-3-visits-1"><i class="fa fa-check"></i><b>5.15.3</b> Merge all 3 visits</a></li>
<li class="chapter" data-level="5.15.4" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#manual-changes-to-column-names-2"><i class="fa fa-check"></i><b>5.15.4</b> Manual changes to column names 2</a></li>
<li class="chapter" data-level="5.15.5" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#final-data-cleaning-1"><i class="fa fa-check"></i><b>5.15.5</b> Final data cleaning</a></li>
</ul></li>
<li class="chapter" data-level="5.16" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#making-a-key-in-google-sheets"><i class="fa fa-check"></i><b>5.16</b> ğŸŸ¢ Making a key in Google Sheets</a>
<ul>
<li class="chapter" data-level="5.16.1" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#create-the-google-sheet-column-name-key"><i class="fa fa-check"></i><b>5.16.1</b> Create the Google Sheet column name key</a></li>
<li class="chapter" data-level="5.16.2" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#import-the-google-sheet-column-name-key"><i class="fa fa-check"></i><b>5.16.2</b> Import the Google Sheet column name key</a></li>
<li class="chapter" data-level="5.16.3" data-path="column-names-prepping-many-for-merge.html"><a href="column-names-prepping-many-for-merge.html#reorder-and-rename-the-current-data-frame"><i class="fa fa-check"></i><b>5.16.3</b> Reorder and rename the current data frame</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Analysis</b></span></li>
<li class="chapter" data-level="6" data-path="contingency-tables.html"><a href="contingency-tables.html"><i class="fa fa-check"></i><b>6</b> Contingency Tables</a>
<ul>
<li class="chapter" data-level="6.1" data-path="contingency-tables.html"><a href="contingency-tables.html#overview-4"><i class="fa fa-check"></i><b>6.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="6.2" data-path="contingency-tables.html"><a href="contingency-tables.html#useful-websites-4"><i class="fa fa-check"></i><b>6.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="6.3" data-path="contingency-tables.html"><a href="contingency-tables.html#load-packages-2"><i class="fa fa-check"></i><b>6.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="6.4" data-path="contingency-tables.html"><a href="contingency-tables.html#terminology"><i class="fa fa-check"></i><b>6.4</b> Terminology</a></li>
<li class="chapter" data-level="6.5" data-path="contingency-tables.html"><a href="contingency-tables.html#scenario"><i class="fa fa-check"></i><b>6.5</b> Scenario</a></li>
<li class="chapter" data-level="6.6" data-path="contingency-tables.html"><a href="contingency-tables.html#manually-creating-each-data-structure"><i class="fa fa-check"></i><b>6.6</b> Manually creating each data structure</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="contingency-tables.html"><a href="contingency-tables.html#data-frame-of-observations"><i class="fa fa-check"></i><b>6.6.1</b> Data frame of observations</a></li>
<li class="chapter" data-level="6.6.2" data-path="contingency-tables.html"><a href="contingency-tables.html#man-freq-tbl"><i class="fa fa-check"></i><b>6.6.2</b> Frequency table</a></li>
<li class="chapter" data-level="6.6.3" data-path="contingency-tables.html"><a href="contingency-tables.html#contingency-tables-1"><i class="fa fa-check"></i><b>6.6.3</b> Contingency tables</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="contingency-tables.html"><a href="contingency-tables.html#table-objects"><i class="fa fa-check"></i><b>6.7</b> Table objects</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="contingency-tables.html"><a href="contingency-tables.html#table-object-from-matrix"><i class="fa fa-check"></i><b>6.7.1</b> Table object from matrix</a></li>
<li class="chapter" data-level="6.7.2" data-path="contingency-tables.html"><a href="contingency-tables.html#table-object-from-df"><i class="fa fa-check"></i><b>6.7.2</b> Table object from df</a></li>
<li class="chapter" data-level="6.7.3" data-path="contingency-tables.html"><a href="contingency-tables.html#why"><i class="fa fa-check"></i><b>6.7.3</b> Why use table objects?</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="contingency-tables.html"><a href="contingency-tables.html#convert-a-contingency-table-into-a-frequency-table"><i class="fa fa-check"></i><b>6.8</b> Convert a contingency table into a frequency table</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="contingency-tables.html"><a href="contingency-tables.html#matrix-object"><i class="fa fa-check"></i><b>6.8.1</b> Matrix object</a></li>
<li class="chapter" data-level="6.8.2" data-path="contingency-tables.html"><a href="contingency-tables.html#table-object-from-df-1"><i class="fa fa-check"></i><b>6.8.2</b> Table object from df</a></li>
<li class="chapter" data-level="6.8.3" data-path="contingency-tables.html"><a href="contingency-tables.html#data-frame-contingency-table"><i class="fa fa-check"></i><b>6.8.3</b> Data frame contingency table</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="contingency-tables.html"><a href="contingency-tables.html#convert-ct-to-df"><i class="fa fa-check"></i><b>6.9</b> Convert a contingency table into a data frame of observations</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="contingency-tables.html"><a href="contingency-tables.html#matrix-object-1"><i class="fa fa-check"></i><b>6.9.1</b> Matrix object</a></li>
<li class="chapter" data-level="6.9.2" data-path="contingency-tables.html"><a href="contingency-tables.html#table-from-matrix-to-df-obs"><i class="fa fa-check"></i><b>6.9.2</b> Table object</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="contingency-tables.html"><a href="contingency-tables.html#convert-a-frequency-table-into-a-contingency-table."><i class="fa fa-check"></i><b>6.10</b> Convert a frequency table into a contingency table.</a></li>
<li class="chapter" data-level="6.11" data-path="contingency-tables.html"><a href="contingency-tables.html#convert-a-frequency-table-into-a-data-frame-of-observations."><i class="fa fa-check"></i><b>6.11</b> Convert a frequency table into a data frame of observations.</a></li>
<li class="chapter" data-level="6.12" data-path="contingency-tables.html"><a href="contingency-tables.html#bottom-line"><i class="fa fa-check"></i><b>6.12</b> Bottom line</a></li>
<li class="chapter" data-level="6.13" data-path="contingency-tables.html"><a href="contingency-tables.html#helper-functions"><i class="fa fa-check"></i><b>6.13</b> Helper functions</a>
<ul>
<li class="chapter" data-level="6.13.1" data-path="contingency-tables.html"><a href="contingency-tables.html#create-a-contingency-table"><i class="fa fa-check"></i><b>6.13.1</b> Create a contingency table</a></li>
<li class="chapter" data-level="6.13.2" data-path="contingency-tables.html"><a href="contingency-tables.html#here-down-needs-refinement"><i class="fa fa-check"></i><b>6.13.2</b> ğŸ”´Here down needs refinement</a></li>
<li class="chapter" data-level="6.13.3" data-path="contingency-tables.html"><a href="contingency-tables.html#counts-to-cases"><i class="fa fa-check"></i><b>6.13.3</b> Counts to cases</a></li>
<li class="chapter" data-level="6.13.4" data-path="contingency-tables.html"><a href="contingency-tables.html#freqtable-to-contingency-table"><i class="fa fa-check"></i><b>6.13.4</b> Freqtable to contingency table</a></li>
<li class="chapter" data-level="6.13.5" data-path="contingency-tables.html"><a href="contingency-tables.html#contingency-table-to-freqtable"><i class="fa fa-check"></i><b>6.13.5</b> Contingency table to freqtable</a></li>
<li class="chapter" data-level="6.13.6" data-path="contingency-tables.html"><a href="contingency-tables.html#freqtable-to-data-frame-of-observations"><i class="fa fa-check"></i><b>6.13.6</b> Freqtable to data frame of observations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="effect-measure-modification.html"><a href="effect-measure-modification.html"><i class="fa fa-check"></i><b>7</b> Effect-measure modification</a>
<ul>
<li class="chapter" data-level="7.1" data-path="effect-measure-modification.html"><a href="effect-measure-modification.html#overview-5"><i class="fa fa-check"></i><b>7.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="7.2" data-path="effect-measure-modification.html"><a href="effect-measure-modification.html#useful-websites-5"><i class="fa fa-check"></i><b>7.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="7.3" data-path="effect-measure-modification.html"><a href="effect-measure-modification.html#load-packages-3"><i class="fa fa-check"></i><b>7.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="7.4" data-path="effect-measure-modification.html"><a href="effect-measure-modification.html#simulate-data-2"><i class="fa fa-check"></i><b>7.4</b> ğŸ”¢Simulate data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="risk-difference.html"><a href="risk-difference.html"><i class="fa fa-check"></i><b>8</b> Risk Difference</a>
<ul>
<li class="chapter" data-level="8.1" data-path="risk-difference.html"><a href="risk-difference.html#overview-6"><i class="fa fa-check"></i><b>8.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="8.2" data-path="risk-difference.html"><a href="risk-difference.html#useful-websites-6"><i class="fa fa-check"></i><b>8.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="8.3" data-path="risk-difference.html"><a href="risk-difference.html#load-packages-4"><i class="fa fa-check"></i><b>8.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="8.4" data-path="risk-difference.html"><a href="risk-difference.html#data-summary"><i class="fa fa-check"></i><b>8.4</b> Data Summary</a></li>
<li class="chapter" data-level="8.5" data-path="risk-difference.html"><a href="risk-difference.html#simulate-data-3"><i class="fa fa-check"></i><b>8.5</b> ğŸ”¢Simulate data</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="risk-difference.html"><a href="risk-difference.html#simulate-a-matrix-object"><i class="fa fa-check"></i><b>8.5.1</b> Simulate a matrix object</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="risk-difference.html"><a href="risk-difference.html#analysis"><i class="fa fa-check"></i><b>8.6</b> ğŸ“ˆAnalysis</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="risk-difference.html"><a href="risk-difference.html#incidence-proportion"><i class="fa fa-check"></i><b>8.6.1</b> Incidence proportion</a></li>
<li class="chapter" data-level="8.6.2" data-path="risk-difference.html"><a href="risk-difference.html#risk-differences"><i class="fa fa-check"></i><b>8.6.2</b> Risk Differences</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Data Visualization</b></span></li>
<li class="chapter" data-level="9" data-path="plot-populations-and-samples.html"><a href="plot-populations-and-samples.html"><i class="fa fa-check"></i><b>9</b> Plot populations and samples</a>
<ul>
<li class="chapter" data-level="9.1" data-path="plot-populations-and-samples.html"><a href="plot-populations-and-samples.html#overview-7"><i class="fa fa-check"></i><b>9.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="9.2" data-path="plot-populations-and-samples.html"><a href="plot-populations-and-samples.html#useful-websites-7"><i class="fa fa-check"></i><b>9.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="9.3" data-path="plot-populations-and-samples.html"><a href="plot-populations-and-samples.html#load-packages-5"><i class="fa fa-check"></i><b>9.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="9.4" data-path="plot-populations-and-samples.html"><a href="plot-populations-and-samples.html#simulate-data-4"><i class="fa fa-check"></i><b>9.4</b> ğŸ”¢Simulate data</a></li>
</ul></li>
<li class="part"><span><b>VI Presenting Results</b></span></li>
<li class="chapter" data-level="10" data-path="blogdown.html"><a href="blogdown.html"><i class="fa fa-check"></i><b>10</b> Blogdown</a>
<ul>
<li class="chapter" data-level="10.1" data-path="blogdown.html"><a href="blogdown.html#overview-8"><i class="fa fa-check"></i><b>10.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="10.2" data-path="blogdown.html"><a href="blogdown.html#useful-websites-8"><i class="fa fa-check"></i><b>10.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="10.3" data-path="blogdown.html"><a href="blogdown.html#load-packages-6"><i class="fa fa-check"></i><b>10.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="10.4" data-path="blogdown.html"><a href="blogdown.html#blogdown-commands-to-remember"><i class="fa fa-check"></i><b>10.4</b> Blogdown commands to remember</a></li>
<li class="chapter" data-level="10.5" data-path="blogdown.html"><a href="blogdown.html#creating-new-content"><i class="fa fa-check"></i><b>10.5</b> Creating new content</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="blogdown.html"><a href="blogdown.html#step-1.-create-a-landing-page"><i class="fa fa-check"></i><b>10.5.1</b> Step 1. Create a landing page</a></li>
<li class="chapter" data-level="10.5.2" data-path="blogdown.html"><a href="blogdown.html#step-2.-add-widgets-to-the-landing-page"><i class="fa fa-check"></i><b>10.5.2</b> Step 2. Add widgets to the landing page</a></li>
<li class="chapter" data-level="10.5.3" data-path="blogdown.html"><a href="blogdown.html#step-3.-add-content-to-the-widgets"><i class="fa fa-check"></i><b>10.5.3</b> Step 3. Add content to the widgets</a></li>
<li class="chapter" data-level="10.5.4" data-path="blogdown.html"><a href="blogdown.html#step-4.-add-a-banner-image-to-the-landing-page."><i class="fa fa-check"></i><b>10.5.4</b> Step 4. Add a banner image to the landing page.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="blogdown.html"><a href="blogdown.html#editing-widget-metadata"><i class="fa fa-check"></i><b>10.6</b> Editing widget metadata</a></li>
<li class="chapter" data-level="10.7" data-path="blogdown.html"><a href="blogdown.html#editing-about-widget-content"><i class="fa fa-check"></i><b>10.7</b> Editing about widget content</a></li>
<li class="chapter" data-level="10.8" data-path="blogdown.html"><a href="blogdown.html#adjusting-site-configuration-files"><i class="fa fa-check"></i><b>10.8</b> Adjusting site configuration files</a></li>
<li class="chapter" data-level="10.9" data-path="blogdown.html"><a href="blogdown.html#other-little-adjustments"><i class="fa fa-check"></i><b>10.9</b> Other little adjustments</a></li>
<li class="chapter" data-level="10.10" data-path="blogdown.html"><a href="blogdown.html#custom-css"><i class="fa fa-check"></i><b>10.10</b> Custom CSS</a></li>
<li class="chapter" data-level="10.11" data-path="blogdown.html"><a href="blogdown.html#changing-the-domain"><i class="fa fa-check"></i><b>10.11</b> Changing the domain</a></li>
<li class="chapter" data-level="10.12" data-path="blogdown.html"><a href="blogdown.html#error-fixes"><i class="fa fa-check"></i><b>10.12</b> Error fixes</a>
<ul>
<li class="chapter" data-level="10.12.1" data-path="blogdown.html"><a href="blogdown.html#blogdowncheck_netlify"><i class="fa fa-check"></i><b>10.12.1</b> blogdown::check_netlify()</a></li>
</ul></li>
<li class="chapter" data-level="10.13" data-path="blogdown.html"><a href="blogdown.html#adding-google-analytics"><i class="fa fa-check"></i><b>10.13</b> Adding Google Analytics</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="book-chapters.html"><a href="book-chapters.html"><i class="fa fa-check"></i><b>11</b> Bookdown: Creating Book Chapters</a>
<ul>
<li class="chapter" data-level="11.1" data-path="book-chapters.html"><a href="book-chapters.html#chapter-overview"><i class="fa fa-check"></i><b>11.1</b> Chapter overview</a></li>
<li class="chapter" data-level="11.2" data-path="book-chapters.html"><a href="book-chapters.html#motivating-example"><i class="fa fa-check"></i><b>11.2</b> Motivating example</a></li>
<li class="chapter" data-level="11.3" data-path="book-chapters.html"><a href="book-chapters.html#body"><i class="fa fa-check"></i><b>11.3</b> Body</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="book-chapters.html"><a href="book-chapters.html#language"><i class="fa fa-check"></i><b>11.3.1</b> Language</a></li>
<li class="chapter" data-level="11.3.2" data-path="book-chapters.html"><a href="book-chapters.html#text-conventions"><i class="fa fa-check"></i><b>11.3.2</b> Text conventions</a></li>
<li class="chapter" data-level="11.3.3" data-path="book-chapters.html"><a href="book-chapters.html#special-sections"><i class="fa fa-check"></i><b>11.3.3</b> Special sections</a></li>
<li class="chapter" data-level="11.3.4" data-path="book-chapters.html"><a href="book-chapters.html#images"><i class="fa fa-check"></i><b>11.3.4</b> Images</a></li>
<li class="chapter" data-level="11.3.5" data-path="book-chapters.html"><a href="book-chapters.html#font-awesome"><i class="fa fa-check"></i><b>11.3.5</b> Font Awesome</a></li>
<li class="chapter" data-level="11.3.6" data-path="book-chapters.html"><a href="book-chapters.html#links"><i class="fa fa-check"></i><b>11.3.6</b> Links</a></li>
<li class="chapter" data-level="11.3.7" data-path="book-chapters.html"><a href="book-chapters.html#code-blocks"><i class="fa fa-check"></i><b>11.3.7</b> Code blocks</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="book-chapters.html"><a href="book-chapters.html#cross-references"><i class="fa fa-check"></i><b>11.4</b> Cross-references</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="book-chapters.html"><a href="book-chapters.html#cr-figs"><i class="fa fa-check"></i><b>11.4.1</b> Cross-referencing figures</a></li>
<li class="chapter" data-level="11.4.2" data-path="book-chapters.html"><a href="book-chapters.html#cross-referencing-chapters"><i class="fa fa-check"></i><b>11.4.2</b> Cross-referencing chapters</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="book-chapters.html"><a href="book-chapters.html#citations"><i class="fa fa-check"></i><b>11.5</b> Citations</a></li>
<li class="chapter" data-level="11.6" data-path="book-chapters.html"><a href="book-chapters.html#previewing-the-chapter"><i class="fa fa-check"></i><b>11.6</b> Previewing the chapter</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="book-chapters.html"><a href="book-chapters.html#miscelaneous"><i class="fa fa-check"></i><b>11.6.1</b> Miscelaneous</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="book-chapters.html"><a href="book-chapters.html#additional-resources-function-to-check"><i class="fa fa-check"></i><b>11.7</b> Additional resources: function to check</a></li>
<li class="chapter" data-level="11.8" data-path="book-chapters.html"><a href="book-chapters.html#key-terms-function-to-add-to-appendix"><i class="fa fa-check"></i><b>11.8</b> Key terms : function to add to appendix</a></li>
<li class="chapter" data-level="11.9" data-path="book-chapters.html"><a href="book-chapters.html#final-example-code-function-to-add-to-appendix"><i class="fa fa-check"></i><b>11.9</b> Final example code : function to add to appendix</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html"><i class="fa fa-check"></i><b>12</b> Bookdown: Quick Start</a>
<ul>
<li class="chapter" data-level="12.1" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#overview-9"><i class="fa fa-check"></i><b>12.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="12.2" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#useful-websites-9"><i class="fa fa-check"></i><b>12.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="12.3" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#creating-the-bookdown-project-locally"><i class="fa fa-check"></i><b>12.3</b> Creating the bookdown project locally</a></li>
<li class="chapter" data-level="12.4" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#initiate-a-git-repository"><i class="fa fa-check"></i><b>12.4</b> Initiate a git repository</a></li>
<li class="chapter" data-level="12.5" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#create-a-github-repository-for-the-book"><i class="fa fa-check"></i><b>12.5</b> Create a github repository for the book</a></li>
<li class="chapter" data-level="12.6" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#configuring-a-publishing-source-for-the-github-pages-site"><i class="fa fa-check"></i><b>12.6</b> Configuring a publishing source for the GitHub Pages site</a></li>
<li class="chapter" data-level="12.7" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#modify-_bookdown.yml"><i class="fa fa-check"></i><b>12.7</b> Modify _bookdown.yml</a></li>
<li class="chapter" data-level="12.8" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#modify-_output.yml"><i class="fa fa-check"></i><b>12.8</b> Modify _output.yml</a></li>
<li class="chapter" data-level="12.9" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#modify-style.css"><i class="fa fa-check"></i><b>12.9</b> Modify style.css</a></li>
<li class="chapter" data-level="12.10" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#modify-index.rmd"><i class="fa fa-check"></i><b>12.10</b> Modify index.Rmd</a></li>
<li class="chapter" data-level="12.11" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#creating-bookdown-chapters"><i class="fa fa-check"></i><b>12.11</b> Creating bookdown chapters</a></li>
<li class="chapter" data-level="12.12" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#knitting-the-book"><i class="fa fa-check"></i><b>12.12</b> Knitting the book</a></li>
<li class="chapter" data-level="12.13" data-path="bookdown-quick-start.html"><a href="bookdown-quick-start.html#errors-and-warnings"><i class="fa fa-check"></i><b>12.13</b> Errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="flexdashboard.html"><a href="flexdashboard.html"><i class="fa fa-check"></i><b>13</b> Flexdashboard</a>
<ul>
<li class="chapter" data-level="13.1" data-path="flexdashboard.html"><a href="flexdashboard.html#overview-10"><i class="fa fa-check"></i><b>13.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="13.2" data-path="flexdashboard.html"><a href="flexdashboard.html#useful-websites-10"><i class="fa fa-check"></i><b>13.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="13.3" data-path="flexdashboard.html"><a href="flexdashboard.html#load-packages-7"><i class="fa fa-check"></i><b>13.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="13.4" data-path="flexdashboard.html"><a href="flexdashboard.html#tips"><i class="fa fa-check"></i><b>13.4</b> Tips</a></li>
<li class="chapter" data-level="13.5" data-path="flexdashboard.html"><a href="flexdashboard.html#simulate-data-5"><i class="fa fa-check"></i><b>13.5</b> ğŸ”¢Simulate data</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="flextable.html"><a href="flextable.html"><i class="fa fa-check"></i><b>14</b> Flextable</a>
<ul>
<li class="chapter" data-level="14.1" data-path="flextable.html"><a href="flextable.html#overview-11"><i class="fa fa-check"></i><b>14.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="14.2" data-path="flextable.html"><a href="flextable.html#useful-websites-11"><i class="fa fa-check"></i><b>14.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="14.3" data-path="flextable.html"><a href="flextable.html#load-packages-8"><i class="fa fa-check"></i><b>14.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="14.4" data-path="flextable.html"><a href="flextable.html#load-data"><i class="fa fa-check"></i><b>14.4</b> Load data</a></li>
<li class="chapter" data-level="14.5" data-path="flextable.html"><a href="flextable.html#i-and-j"><i class="fa fa-check"></i><b>14.5</b> ğŸ”µ i and j</a></li>
<li class="chapter" data-level="14.6" data-path="flextable.html"><a href="flextable.html#flextable-wrappers"><i class="fa fa-check"></i><b>14.6</b> ğŸ”µ Flextable wrappers</a></li>
<li class="chapter" data-level="14.7" data-path="flextable.html"><a href="flextable.html#addingmodifying-table-content"><i class="fa fa-check"></i><b>14.7</b> ğŸ”µ Adding/modifying table content</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="flextable.html"><a href="flextable.html#add-table-title-with-bold-part"><i class="fa fa-check"></i><b>14.7.1</b> Add table title with bold part</a></li>
<li class="chapter" data-level="14.7.2" data-path="flextable.html"><a href="flextable.html#adding-blank-rows"><i class="fa fa-check"></i><b>14.7.2</b> Adding blank rows</a></li>
<li class="chapter" data-level="14.7.3" data-path="flextable.html"><a href="flextable.html#change-column-header-text"><i class="fa fa-check"></i><b>14.7.3</b> Change column header text</a></li>
<li class="chapter" data-level="14.7.4" data-path="flextable.html"><a href="flextable.html#change-row-header-text"><i class="fa fa-check"></i><b>14.7.4</b> Change row header text</a></li>
<li class="chapter" data-level="14.7.5" data-path="flextable.html"><a href="flextable.html#add-footnote"><i class="fa fa-check"></i><b>14.7.5</b> Add footnote</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="flextable.html"><a href="flextable.html#formatting"><i class="fa fa-check"></i><b>14.8</b> ğŸ”µ Formatting</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path="flextable.html"><a href="flextable.html#change-font-to-tnr"><i class="fa fa-check"></i><b>14.8.1</b> Change font to TNR</a></li>
<li class="chapter" data-level="14.8.2" data-path="flextable.html"><a href="flextable.html#conditional-formatting"><i class="fa fa-check"></i><b>14.8.2</b> Conditional formatting</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="flextable.html"><a href="flextable.html#layout"><i class="fa fa-check"></i><b>14.9</b> ğŸ”µLayout</a>
<ul>
<li class="chapter" data-level="14.9.1" data-path="flextable.html"><a href="flextable.html#autofit-to-contents"><i class="fa fa-check"></i><b>14.9.1</b> Autofit to contents</a></li>
</ul></li>
<li class="chapter" data-level="14.10" data-path="flextable.html"><a href="flextable.html#examples"><i class="fa fa-check"></i><b>14.10</b> ğŸ”µ Examples</a>
<ul>
<li class="chapter" data-level="14.10.1" data-path="flextable.html"><a href="flextable.html#lead-panel-summarize-votes"><i class="fa fa-check"></i><b>14.10.1</b> LEAD panel summarize votes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="language-for-publications.html"><a href="language-for-publications.html"><i class="fa fa-check"></i><b>15</b> Language for publications</a>
<ul>
<li class="chapter" data-level="15.1" data-path="language-for-publications.html"><a href="language-for-publications.html#overview-12"><i class="fa fa-check"></i><b>15.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="15.2" data-path="language-for-publications.html"><a href="language-for-publications.html#useful-websites-12"><i class="fa fa-check"></i><b>15.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="15.3" data-path="language-for-publications.html"><a href="language-for-publications.html#load-packages-9"><i class="fa fa-check"></i><b>15.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="15.4" data-path="language-for-publications.html"><a href="language-for-publications.html#statistical-software"><i class="fa fa-check"></i><b>15.4</b> Statistical software</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="language-for-publications.html"><a href="language-for-publications.html#r"><i class="fa fa-check"></i><b>15.4.1</b> R</a></li>
<li class="chapter" data-level="15.4.2" data-path="language-for-publications.html"><a href="language-for-publications.html#stata"><i class="fa fa-check"></i><b>15.4.2</b> Stata</a></li>
<li class="chapter" data-level="15.4.3" data-path="language-for-publications.html"><a href="language-for-publications.html#sas"><i class="fa fa-check"></i><b>15.4.3</b> SAS</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="language-for-publications.html"><a href="language-for-publications.html#irb"><i class="fa fa-check"></i><b>15.5</b> IRB</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="officer.html"><a href="officer.html"><i class="fa fa-check"></i><b>16</b> Officer</a>
<ul>
<li class="chapter" data-level="16.1" data-path="officer.html"><a href="officer.html#overview-13"><i class="fa fa-check"></i><b>16.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="16.2" data-path="officer.html"><a href="officer.html#useful-websites-13"><i class="fa fa-check"></i><b>16.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="16.3" data-path="officer.html"><a href="officer.html#load-packages-10"><i class="fa fa-check"></i><b>16.3</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="16.4" data-path="officer.html"><a href="officer.html#formatted-text"><i class="fa fa-check"></i><b>16.4</b> Formatted text</a></li>
<li class="chapter" data-level="16.5" data-path="officer.html"><a href="officer.html#bulleted-list"><i class="fa fa-check"></i><b>16.5</b> Bulleted list</a></li>
<li class="chapter" data-level="16.6" data-path="officer.html"><a href="officer.html#adding-on-to-the-end-of-a-file."><i class="fa fa-check"></i><b>16.6</b> Adding on to the end of a file.</a></li>
<li class="chapter" data-level="16.7" data-path="officer.html"><a href="officer.html#using-bookmarks"><i class="fa fa-check"></i><b>16.7</b> Using bookmarks</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>17</b> Tables</a>
<ul>
<li class="chapter" data-level="17.1" data-path="tables.html"><a href="tables.html#overview-14"><i class="fa fa-check"></i><b>17.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="17.2" data-path="tables.html"><a href="tables.html#projects-to-review-and-incorporate"><i class="fa fa-check"></i><b>17.2</b> Projects to review and incorporate</a></li>
<li class="chapter" data-level="17.3" data-path="tables.html"><a href="tables.html#useful-websites-14"><i class="fa fa-check"></i><b>17.3</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="17.4" data-path="tables.html"><a href="tables.html#load-packages-11"><i class="fa fa-check"></i><b>17.4</b> ğŸ“¦Load packages</a></li>
<li class="chapter" data-level="17.5" data-path="tables.html"><a href="tables.html#simulate-data-6"><i class="fa fa-check"></i><b>17.5</b> ğŸ”¢Simulate data</a></li>
<li class="chapter" data-level="17.6" data-path="tables.html"><a href="tables.html#example-table-1"><i class="fa fa-check"></i><b>17.6</b> ğŸ”µ Example: Table 1</a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="tables.html"><a href="tables.html#step-1.-calculate-the-outcome-distribution"><i class="fa fa-check"></i><b>17.6.1</b> Step 1. Calculate the outcome distribution</a></li>
<li class="chapter" data-level="17.6.2" data-path="tables.html"><a href="tables.html#step-2.-prepare-to-calculate-summary-statistics"><i class="fa fa-check"></i><b>17.6.2</b> Step 2. Prepare to calculate summary statistics</a></li>
<li class="chapter" data-level="17.6.3" data-path="tables.html"><a href="tables.html#step-3.-create-a-data-frame-that-contains-our-summary-statistics"><i class="fa fa-check"></i><b>17.6.3</b> Step 3. Create a data frame that contains our summary statistics</a></li>
<li class="chapter" data-level="17.6.4" data-path="tables.html"><a href="tables.html#step-5.-create-flextable"><i class="fa fa-check"></i><b>17.6.4</b> Step 5. Create flextable</a></li>
<li class="chapter" data-level="17.6.5" data-path="tables.html"><a href="tables.html#step-6.-formatting-flextable"><i class="fa fa-check"></i><b>17.6.5</b> Step 6. Formatting flextable</a></li>
<li class="chapter" data-level="17.6.6" data-path="tables.html"><a href="tables.html#load-word-template-for-officer"><i class="fa fa-check"></i><b>17.6.6</b> ğŸ“ Load Word template for officer</a></li>
<li class="chapter" data-level="17.6.7" data-path="tables.html"><a href="tables.html#generate-word-reports"><i class="fa fa-check"></i><b>17.6.7</b> ğŸ“ Generate Word reports</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Shiny</b></span></li>
<li class="part"><span><b>VIII Collaborating</b></span></li>
<li class="chapter" data-level="18" data-path="git-and-github.html"><a href="git-and-github.html"><i class="fa fa-check"></i><b>18</b> Git and GitHub</a>
<ul>
<li class="chapter" data-level="18.1" data-path="git-and-github.html"><a href="git-and-github.html#overview-15"><i class="fa fa-check"></i><b>18.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="18.2" data-path="git-and-github.html"><a href="git-and-github.html#useful-websites-15"><i class="fa fa-check"></i><b>18.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="18.3" data-path="git-and-github.html"><a href="git-and-github.html#commit-message"><i class="fa fa-check"></i><b>18.3</b> Commit message</a></li>
<li class="chapter" data-level="18.4" data-path="git-and-github.html"><a href="git-and-github.html#get-rid-of-.ds_store-1"><i class="fa fa-check"></i><b>18.4</b> Get rid of .DS_Store</a></li>
<li class="chapter" data-level="18.5" data-path="git-and-github.html"><a href="git-and-github.html#amend"><i class="fa fa-check"></i><b>18.5</b> Amend</a></li>
<li class="chapter" data-level="18.6" data-path="git-and-github.html"><a href="git-and-github.html#pull-requests"><i class="fa fa-check"></i><b>18.6</b> Pull Requests</a></li>
<li class="chapter" data-level="18.7" data-path="git-and-github.html"><a href="git-and-github.html#branches"><i class="fa fa-check"></i><b>18.7</b> Branches</a></li>
<li class="chapter" data-level="18.8" data-path="git-and-github.html"><a href="git-and-github.html#squashing-commits"><i class="fa fa-check"></i><b>18.8</b> Squashing commits</a></li>
</ul></li>
<li class="part"><span><b>IX Appendix</b></span></li>
<li class="chapter" data-level="19" data-path="appendix-a-terms-and-definitions.html"><a href="appendix-a-terms-and-definitions.html"><i class="fa fa-check"></i><b>19</b> Appendix A: Terms and Definitions</a>
<ul>
<li class="chapter" data-level="19.1" data-path="appendix-a-terms-and-definitions.html"><a href="appendix-a-terms-and-definitions.html#overview-16"><i class="fa fa-check"></i><b>19.1</b> â­ï¸Overview</a></li>
<li class="chapter" data-level="19.2" data-path="appendix-a-terms-and-definitions.html"><a href="appendix-a-terms-and-definitions.html#useful-websites-16"><i class="fa fa-check"></i><b>19.2</b> ğŸŒUseful websites</a></li>
<li class="chapter" data-level="19.3" data-path="appendix-a-terms-and-definitions.html"><a href="appendix-a-terms-and-definitions.html#terms"><i class="fa fa-check"></i><b>19.3</b> ğŸ“–Terms</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="appendix-a-terms-and-definitions.html"><a href="appendix-a-terms-and-definitions.html#general-terms"><i class="fa fa-check"></i><b>19.3.1</b> General Terms</a></li>
<li class="chapter" data-level="19.3.2" data-path="appendix-a-terms-and-definitions.html"><a href="appendix-a-terms-and-definitions.html#general-statistics-terms"><i class="fa fa-check"></i><b>19.3.2</b> General statistics terms</a></li>
<li class="chapter" data-level="19.3.3" data-path="appendix-a-terms-and-definitions.html"><a href="appendix-a-terms-and-definitions.html#measures-of-occurence"><i class="fa fa-check"></i><b>19.3.3</b> Measures of occurence</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidy-evaluation" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Tidy Evaluation</h1>
<p>Created: 2017-06-24 <br> Updated: 2022-05-07</p>
<!--
Hidden comments placeholder
bookdown::preview_chapter("/Users/bradcannell/Dropbox/R/r_notes_bookdown/chapters/01_programming/tidy_evaluation.Rmd")
-->
<p><img src="https://picsum.photos/200/300" /><!-- --></p>
<div id="overview-2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> â­ï¸Overview</h2>
<p>This chapter is about tidy evaluation. Tidy evaluation has gone through several fairly significant changes since I first wrote these notes.</p>
<p><a href="https://rlang.r-lib.org/news/index.html#rlang-031">Rlang 0.3.1</a> replaced <code>quo_name()</code> with <code>as_label()</code> and <code>as_name()</code>.</p>
<p><a href="https://www.tidyverse.org/blog/2019/06/rlang-0-4-0/">Rlang 0.4.0</a> add the curly-curly syntax.</p>
</div>
<div id="useful-websites-2" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> ğŸŒUseful websites</h2>
<ul>
<li><a href="https://rlang.r-lib.org/index.html">Rlang packagedown site</a><br />
</li>
<li><a href="https://tidyeval.tidyverse.org/">Tidy evaluation book</a><br />
</li>
<li><a href="https://dplyr.tidyverse.org/articles/programming.html">Programming with dplyr</a><br />
</li>
<li><a href="https://ggplot2.tidyverse.org/articles/ggplot2-in-packages.html">Using ggplot2 in packages</a><br />
</li>
<li><a href="https://www.tidyverse.org/blog/2019/06/rlang-0-4-0/">Rlang adds curly-curly</a><br />
</li>
<li><a href="https://adv-r.hadley.nz/metaprogramming.html">Advanced R, metaprogramming</a><br />
</li>
<li><a href="https://www.r4epi.com/introduction-to-repeated-operations.html#tidy-evaluation">R4Epi - Tidy Evaluation</a><br />
</li>
<li><a href="https://www.r4epi.com/writing-functions.html#tidy-evaluation-1">R4Epi - writing functions</a></li>
</ul>
</div>
<div id="load-packages" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> ğŸ“¦Load packages</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="tidy-evaluation.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-2"><a href="tidy-evaluation.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-3"><a href="tidy-evaluation.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-4"><a href="tidy-evaluation.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span></code></pre></div>
</div>
<div id="simulate-data" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> ğŸ”¢Simulate data</h2>
<p>Here we simulate a small dataset that is intended to be representative of data from a research study.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="tidy-evaluation.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-2"><a href="tidy-evaluation.html#cb23-2" aria-hidden="true" tabindex="-1"></a>study <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-3"><a href="tidy-evaluation.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id     =</span> <span class="fu">as.character</span>(<span class="fu">seq</span>(<span class="dv">1001</span>, <span class="dv">1020</span>, <span class="dv">1</span>)),</span>
<span id="cb23-4"><a href="tidy-evaluation.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex    =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>), <span class="dv">20</span>, <span class="cn">TRUE</span>)),</span>
<span id="cb23-5"><a href="tidy-evaluation.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">date   =</span> <span class="fu">sample</span>(<span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2021-09-15&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-10-26&quot;</span>), <span class="st">&quot;day&quot;</span>), <span class="dv">20</span>, <span class="cn">TRUE</span>),</span>
<span id="cb23-6"><a href="tidy-evaluation.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">days   =</span> <span class="fu">sample</span>(1L<span class="sc">:</span>21L, 20L, <span class="cn">TRUE</span>),</span>
<span id="cb23-7"><a href="tidy-evaluation.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">71</span>, <span class="dv">10</span>)</span>
<span id="cb23-8"><a href="tidy-evaluation.html#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-9"><a href="tidy-evaluation.html#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="tidy-evaluation.html#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add missing values for testing</span></span>
<span id="cb23-11"><a href="tidy-evaluation.html#cb23-11" aria-hidden="true" tabindex="-1"></a>study<span class="sc">$</span>id[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-12"><a href="tidy-evaluation.html#cb23-12" aria-hidden="true" tabindex="-1"></a>study<span class="sc">$</span>sex[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-13"><a href="tidy-evaluation.html#cb23-13" aria-hidden="true" tabindex="-1"></a>study<span class="sc">$</span>date[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-14"><a href="tidy-evaluation.html#cb23-14" aria-hidden="true" tabindex="-1"></a>study<span class="sc">$</span>days[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-15"><a href="tidy-evaluation.html#cb23-15" aria-hidden="true" tabindex="-1"></a>study<span class="sc">$</span>height[<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
</div>
<div id="load-starwars-data" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Load Starwars data</h2>
<p>We will also load the <code>mtcars</code> data <code>starwars</code> data used in many of the Tidyverse examples.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="tidy-evaluation.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(starwars)</span>
<span id="cb24-2"><a href="tidy-evaluation.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span></code></pre></div>
</div>
<div id="why-use-tidy-evaluation" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Why use tidy evaluation?</h2>
<p>The short answer is because of data masking, which is easier to see than describe.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="tidy-evaluation.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unmasked programming</span></span>
<span id="cb25-2"><a href="tidy-evaluation.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mtcars<span class="sc">$</span>cyl <span class="sc">+</span> mtcars<span class="sc">$</span>am)</span></code></pre></div>
<pre><code>## [1] 6.59375</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="tidy-evaluation.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Referring to columns is an error - Where is the data?</span></span>
<span id="cb27-2"><a href="tidy-evaluation.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(cyl <span class="sc">+</span> am)</span></code></pre></div>
<pre><code>## Error in mean(cyl + am): object &#39;cyl&#39; not found</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="tidy-evaluation.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data-masking (using base R)</span></span>
<span id="cb29-2"><a href="tidy-evaluation.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(mtcars, <span class="fu">mean</span>(cyl <span class="sc">+</span> am))</span></code></pre></div>
<pre><code>## [1] 6.59375</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="tidy-evaluation.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data-masking (using dplyr)</span></span>
<span id="cb31-2"><a href="tidy-evaluation.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(mtcars, <span class="fu">mean</span>(cyl <span class="sc">+</span> am))</span></code></pre></div>
<pre><code>##   mean(cyl + am)
## 1        6.59375</code></pre>
</div>
<div id="what-is-tidy-evaluation" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> What is tidy evaluation?</h2>
<p><strong>Tidy Eval</strong> is as system for <strong>programming</strong> (i.e., writing new functions), as opposed to working interactively with <strong>dplyr</strong>.</p>
<blockquote>
<p>While data-masking makes it easy to program interactively with data frames, it makes it harder to create functions. Passing data-masked arguments to functions requires injection with the embracing operator {{ or, in more complex cases, the injection operator !!. <a href="https://rlang.r-lib.org/reference/topic-data-mask.html">rlang documentation</a></p>
</blockquote>
<p>So, tidy evaluation, operationalized primarily through the <a href="https://rlang.r-lib.org/index.html">rlang package</a>, is shorthand for a set of tools that allows us to more easily use data masking in the functions that we write. It also allows us to use other functions that use data masking (e.g., <code>dplyr</code> functions) the functions that we write.</p>
</div>
<div id="vocabulary" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Vocabulary</h2>
<p>The old vocabulary was heavily centered around <strong>quasiquotation</strong>. It appears as thought the rlang team is moving towards using the terms <strong>defusing</strong>, <strong>embracing</strong> and <strong>injecting</strong>.</p>
<blockquote>
<p>Injection (also known as quasiquotation) is a metaprogramming feature that allows you to modify parts of a program. This is needed because under the hood data-masking works by defusing R code to prevent its immediate evaluation. The <a href="https://rlang.r-lib.org/reference/topic-defuse.html">defused</a> code is resumed later on in a context where data frame columns are defined. <a href="https://rlang.r-lib.org/reference/topic-data-mask.html">rlang documentation</a></p>
</blockquote>
<blockquote>
<p>One purpose for defusing evaluation of an expression is to interface with data-masking functions by injecting the expression back into another function with !!. This is the defuse-and-inject pattern. <a href="https://rlang.r-lib.org/reference/topic-data-mask.html">rlang documentation</a></p>
</blockquote>
<p><strong>The defuse-and-inject pattern</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="tidy-evaluation.html#cb33-1" aria-hidden="true" tabindex="-1"></a>my_summarise <span class="ot">&lt;-</span> <span class="cf">function</span>(data, arg) {</span>
<span id="cb33-2"><a href="tidy-evaluation.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Defuse the user expression in `arg`</span></span>
<span id="cb33-3"><a href="tidy-evaluation.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  arg <span class="ot">&lt;-</span> <span class="fu">enquo</span>(arg)</span>
<span id="cb33-4"><a href="tidy-evaluation.html#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="tidy-evaluation.html#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inject the expression contained in `arg`</span></span>
<span id="cb33-6"><a href="tidy-evaluation.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inside a `summarise()` argument</span></span>
<span id="cb33-7"><a href="tidy-evaluation.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(<span class="sc">!!</span>arg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb33-8"><a href="tidy-evaluation.html#cb33-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Defuse-and-inject is usually performed in a single step with the embrace operator <code>{{</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="tidy-evaluation.html#cb34-1" aria-hidden="true" tabindex="-1"></a>my_summarise <span class="ot">&lt;-</span> <span class="cf">function</span>(data, arg) {</span>
<span id="cb34-2"><a href="tidy-evaluation.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Defuse and inject in a single step with the embracing operator</span></span>
<span id="cb34-3"><a href="tidy-evaluation.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>({{ arg }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb34-4"><a href="tidy-evaluation.html#cb34-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<blockquote>
<p>Using enquo() and !! separately is useful in more complex cases where you need access to the defused expression instead of just passing it on. <a href="https://rlang.r-lib.org/reference/topic-data-mask.html">rlang documentation</a></p>
</blockquote>
<p><strong>Defused arguments and quosures</strong></p>
<blockquote>
<p>If you inspect the return values of <code>expr()</code> and <code>enquo()</code>, youâ€™ll notice that the latter doesnâ€™t return a raw expression like the former. Instead it returns a <a href="https://rlang.r-lib.org/reference/quosure-tools.html">quosure</a>, a wrapper containing an expression and an environment. <a href="https://rlang.r-lib.org/reference/topic-data-mask.html">rlang documentation</a></p>
</blockquote>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="tidy-evaluation.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 1 + 1</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="tidy-evaluation.html#cb37-1" aria-hidden="true" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(arg) <span class="fu">enquo</span>(arg)</span>
<span id="cb37-2"><a href="tidy-evaluation.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">my_function</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## &lt;quosure&gt;
## expr: ^1 + 1
## env:  global</code></pre>
<blockquote>
<p>R needs information about the environment to properly evaluate argument expressions because they come from a different context than the current function. <a href="https://rlang.r-lib.org/reference/topic-data-mask.html">rlang documentation</a></p>
</blockquote>
</div>
<div id="key_functions" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Key Functions</h2>
<div id="the-qq_show-function" class="section level3" number="3.9.1">
<h3><span class="header-section-number">3.9.1</span> The qq_show function</h3>
<p>The <code>qq_show()</code> function helps examining injected expressions inside a function. This is useful for learning about injection and for debugging injection code.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="tidy-evaluation.html#cb39-1" aria-hidden="true" tabindex="-1"></a>my_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var) {</span>
<span id="cb39-2"><a href="tidy-evaluation.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  rlang<span class="sc">::</span><span class="fu">qq_show</span>(data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">mean</span>({{ var }})))</span>
<span id="cb39-3"><a href="tidy-evaluation.html#cb39-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-4"><a href="tidy-evaluation.html#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="tidy-evaluation.html#cb39-5" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">my_mean</span>(cyl)</span></code></pre></div>
<pre><code>## data %&gt;% dplyr::summarise(mean(^cyl))</code></pre>
</div>
<div id="the-quo-function" class="section level3" number="3.9.2">
<h3><span class="header-section-number">3.9.2</span> The quo function</h3>
<p>The <code>quo()</code> function creates a class <strong>quoture</strong> object, which is a special type of formula.</p>
<p>Use <code>quo()</code> to capture expressions when programming outside of user-defined functions.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="tidy-evaluation.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What does quo() return?</span></span>
<span id="cb41-2"><a href="tidy-evaluation.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quo</span>(species) <span class="co"># Where species is a variable in the Starwars tibble</span></span></code></pre></div>
<pre><code>## &lt;quosure&gt;
## expr: ^species
## env:  global</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="tidy-evaluation.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic usage of quo() in function</span></span>
<span id="cb43-2"><a href="tidy-evaluation.html#cb43-2" aria-hidden="true" tabindex="-1"></a>freq_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x, ...) {</span>
<span id="cb43-3"><a href="tidy-evaluation.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span>            <span class="co"># No quoting and unquoting necessary for the tibble</span></span>
<span id="cb43-4"><a href="tidy-evaluation.html#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="sc">!!</span>x) <span class="sc">%&gt;%</span>  <span class="co"># Don&#39;t forget to unquote (!!) where you want the quoture evaluated</span></span>
<span id="cb43-5"><a href="tidy-evaluation.html#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">top_n</span>(<span class="dv">3</span>, n)     <span class="co"># Return top 3 results</span></span>
<span id="cb43-6"><a href="tidy-evaluation.html#cb43-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-7"><a href="tidy-evaluation.html#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="tidy-evaluation.html#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">freq_table</span>(<span class="at">df =</span> starwars, <span class="at">x =</span> <span class="fu">quo</span>(species))</span></code></pre></div>
<pre><code>## # A tibble: 3 Ã— 2
##   species     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Droid       6
## 2 Human      35
## 3 &lt;NA&gt;        4</code></pre>
</div>
<div id="the-enquo-function" class="section level3" number="3.9.3">
<h3><span class="header-section-number">3.9.3</span> The enquo function</h3>
<p>If you want the user of your function to be able to pass the variable name as an argument without wrapping in <code>quo()</code>, thatâ€™s where <code>enquo()</code> comes in.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="tidy-evaluation.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic usage of enquo() in function</span></span>
<span id="cb45-2"><a href="tidy-evaluation.html#cb45-2" aria-hidden="true" tabindex="-1"></a>freq_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x, ...) {</span>
<span id="cb45-3"><a href="tidy-evaluation.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(x)     <span class="co"># Capturing function argument and turning it into a quoture</span></span>
<span id="cb45-4"><a href="tidy-evaluation.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span>                             </span>
<span id="cb45-5"><a href="tidy-evaluation.html#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="sc">!!</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="tidy-evaluation.html#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">top_n</span>(<span class="dv">3</span>, n)                      </span>
<span id="cb45-7"><a href="tidy-evaluation.html#cb45-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-8"><a href="tidy-evaluation.html#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="tidy-evaluation.html#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">freq_table</span>(<span class="at">df =</span> starwars, <span class="at">x =</span> species) <span class="co"># Notice we no longer need to wrap species with quo()</span></span></code></pre></div>
<pre><code>## # A tibble: 3 Ã— 2
##   species     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Droid       6
## 2 Human      35
## 3 &lt;NA&gt;        4</code></pre>
</div>
<div id="the-embrace-operator" class="section level3" number="3.9.4">
<h3><span class="header-section-number">3.9.4</span> The embrace operator</h3>
<p>As mentioned above in the discussion of the defuse-and-inject pattern, the embrace operator <code>{{</code> can often be used to defuse-and-inject in a single step.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="tidy-evaluation.html#cb47-1" aria-hidden="true" tabindex="-1"></a>freq_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x, ...) {</span>
<span id="cb47-2"><a href="tidy-evaluation.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span>                             </span>
<span id="cb47-3"><a href="tidy-evaluation.html#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>({{ x }}) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="tidy-evaluation.html#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">top_n</span>(<span class="dv">3</span>, n)                      </span>
<span id="cb47-5"><a href="tidy-evaluation.html#cb47-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-6"><a href="tidy-evaluation.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="tidy-evaluation.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">freq_table</span>(<span class="at">df =</span> starwars, <span class="at">x =</span> species)</span></code></pre></div>
<pre><code>## # A tibble: 3 Ã— 2
##   species     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Droid       6
## 2 Human      35
## 3 &lt;NA&gt;        4</code></pre>
<p>Where the embrace operator can get you in trouble is with nested functions (<a href="tidy-evaluation.html#nesting">see below</a>) and unquote-splicing (<a href="tidy-evaluation.html#enquos">see below</a>).</p>
</div>
<div id="the-quos-function" class="section level3" number="3.9.5">
<h3><span class="header-section-number">3.9.5</span> The quos function</h3>
<p>Use <code>quos()</code> with <code>...</code> when you want to pass multiple variables / arguments / expressions into your function. Must unquote-splice <code>!!!</code> in your function to evaluate.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="tidy-evaluation.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What does quos() return?</span></span>
<span id="cb49-2"><a href="tidy-evaluation.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quos</span>(species, name) <span class="co"># Where species and name are variables in the Starwars tibble</span></span></code></pre></div>
<pre><code>## &lt;list_of&lt;quosure&gt;&gt;
## 
## [[1]]
## &lt;quosure&gt;
## expr: ^species
## env:  global
## 
## [[2]]
## &lt;quosure&gt;
## expr: ^name
## env:  global</code></pre>
<p>You can iterate over the list of quotures returned by <code>quos()</code></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="tidy-evaluation.html#cb51-1" aria-hidden="true" tabindex="-1"></a>my_quos <span class="ot">&lt;-</span> <span class="fu">quos</span>(species, name)</span>
<span id="cb51-2"><a href="tidy-evaluation.html#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="tidy-evaluation.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(my_quos)) {</span>
<span id="cb51-4"><a href="tidy-evaluation.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(my_quos[[i]])</span>
<span id="cb51-5"><a href="tidy-evaluation.html#cb51-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## &lt;quosure&gt;
## expr: ^species
## env:  global
## &lt;quosure&gt;
## expr: ^name
## env:  global</code></pre>
</div>
<div id="enquos" class="section level3" number="3.9.6">
<h3><span class="header-section-number">3.9.6</span> The enquos function</h3>
<p>Typically you will use <code>enquos()</code> instead of <code>quos()</code>, and use it with the dot-dot-dot argument to a function. When you do, donâ€™t forget to unquote-splice with <code>!!!</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="tidy-evaluation.html#cb53-1" aria-hidden="true" tabindex="-1"></a>grouped_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x, ...) {</span>
<span id="cb53-2"><a href="tidy-evaluation.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  mean_var <span class="ot">&lt;-</span> <span class="fu">enquo</span>(x)</span>
<span id="cb53-3"><a href="tidy-evaluation.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  group_vars <span class="ot">&lt;-</span> <span class="fu">enquos</span>(...)</span>
<span id="cb53-4"><a href="tidy-evaluation.html#cb53-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-5"><a href="tidy-evaluation.html#cb53-5" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb53-6"><a href="tidy-evaluation.html#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!!</span>group_vars) <span class="sc">%&gt;%</span> </span>
<span id="cb53-7"><a href="tidy-evaluation.html#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(<span class="sc">!!</span>mean_var), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb53-8"><a href="tidy-evaluation.html#cb53-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-9"><a href="tidy-evaluation.html#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="tidy-evaluation.html#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="fu">grouped_mean</span>(mtcars, disp, cyl, am)</span></code></pre></div>
<pre><code>## # A tibble: 6 Ã— 3
##     cyl    am  mean
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     4     0 136. 
## 2     4     1  93.6
## 3     6     0 205. 
## 4     6     1 155  
## 5     8     0 358. 
## 6     8     1 326</code></pre>
<p>Or</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="tidy-evaluation.html#cb55-1" aria-hidden="true" tabindex="-1"></a>freq_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df, ...) { <span class="co"># Notice we dropped the &quot;x&quot; argument</span></span>
<span id="cb55-2"><a href="tidy-evaluation.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquos</span>(...)                <span class="co"># Capturing function argument and turning it into a quoture list</span></span>
<span id="cb55-3"><a href="tidy-evaluation.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-4"><a href="tidy-evaluation.html#cb55-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span>                             </span>
<span id="cb55-5"><a href="tidy-evaluation.html#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="sc">!!!</span>x) <span class="sc">%&gt;%</span>               <span class="co"># Must use unquote-splice (!!!) in this case</span></span>
<span id="cb55-6"><a href="tidy-evaluation.html#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)                      </span>
<span id="cb55-7"><a href="tidy-evaluation.html#cb55-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-8"><a href="tidy-evaluation.html#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="tidy-evaluation.html#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">freq_table</span>(<span class="at">df =</span> starwars, species, hair_color)</span></code></pre></div>
<pre><code>## # A tibble: 5 Ã— 3
##   species  hair_color     n
##   &lt;chr&gt;    &lt;chr&gt;      &lt;int&gt;
## 1 Aleena   none           1
## 2 Besalisk none           1
## 3 Cerean   white          1
## 4 Chagrian none           1
## 5 Clawdite blonde         1</code></pre>
<p><strong>Note</strong> that the embrace operator cannot be used to unquote-splice the <code>...</code> argument.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="tidy-evaluation.html#cb57-1" aria-hidden="true" tabindex="-1"></a>freq_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df, ...) { </span>
<span id="cb57-2"><a href="tidy-evaluation.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span>                             </span>
<span id="cb57-3"><a href="tidy-evaluation.html#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>({{ ... }}) <span class="sc">%&gt;%</span>  <span class="co"># Must use unquote-splice (!!!) in this case</span></span>
<span id="cb57-4"><a href="tidy-evaluation.html#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)                      </span>
<span id="cb57-5"><a href="tidy-evaluation.html#cb57-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-6"><a href="tidy-evaluation.html#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="tidy-evaluation.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">freq_table</span>(<span class="at">df =</span> starwars, species, hair_color)</span></code></pre></div>
<pre><code>## Error in splice(dot_call(capture_dots, frame_env = frame_env, named = named, : object &#39;hair_color&#39; not found</code></pre>
</div>
<div id="the-as_label-and-as_name-functions" class="section level3" number="3.9.7">
<h3><span class="header-section-number">3.9.7</span> The as_label and as_name functions</h3>
<p><a href="https://rlang.r-lib.org/news/index.html#rlang-031">Rlang 0.3.1</a> replaced <code>quo_name()</code> with <code>as_label()</code> and <code>as_name()</code>.</p>
<p>Sometimes we want to convert the argument to a string for use in our function output. For example, we may want to dynamically create variable names inside the function.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="tidy-evaluation.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What does as_label and as_name return?</span></span>
<span id="cb59-2"><a href="tidy-evaluation.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Input must be a string or a quoture</span></span>
<span id="cb59-3"><a href="tidy-evaluation.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb59-4"><a href="tidy-evaluation.html#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">as_label_quotes  =</span> rlang<span class="sc">::</span><span class="fu">as_label</span>(<span class="st">&quot;height&quot;</span>),</span>
<span id="cb59-5"><a href="tidy-evaluation.html#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">as_lable_quoture =</span> rlang<span class="sc">::</span><span class="fu">as_label</span>(<span class="fu">quo</span>(height)),</span>
<span id="cb59-6"><a href="tidy-evaluation.html#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">as_name_quotes   =</span> rlang<span class="sc">::</span><span class="fu">as_name</span>(<span class="st">&quot;height&quot;</span>),</span>
<span id="cb59-7"><a href="tidy-evaluation.html#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">as_name_quoture  =</span> rlang<span class="sc">::</span><span class="fu">as_name</span>(<span class="fu">quo</span>(height))</span>
<span id="cb59-8"><a href="tidy-evaluation.html#cb59-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## $as_label_quotes
## [1] &quot;\&quot;height\&quot;&quot;
## 
## $as_lable_quoture
## [1] &quot;height&quot;
## 
## $as_name_quotes
## [1] &quot;height&quot;
## 
## $as_name_quoture
## [1] &quot;height&quot;</code></pre>
<p>I still donâ€™t fully understand when to use one versus the other, but so far, they have been most useful for converting symbols/quotures to character strings.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="tidy-evaluation.html#cb61-1" aria-hidden="true" tabindex="-1"></a>continuous_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x) {</span>
<span id="cb61-2"><a href="tidy-evaluation.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(x)                                 <span class="co"># Must enquo first</span></span>
<span id="cb61-3"><a href="tidy-evaluation.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  mean_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;mean_&quot;</span>, rlang<span class="sc">::</span><span class="fu">as_name</span>(x))</span>
<span id="cb61-4"><a href="tidy-evaluation.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  sum_name  <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;sum_&quot;</span>, rlang<span class="sc">::</span><span class="fu">as_name</span>(x))</span>
<span id="cb61-5"><a href="tidy-evaluation.html#cb61-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-6"><a href="tidy-evaluation.html#cb61-6" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb61-7"><a href="tidy-evaluation.html#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb61-8"><a href="tidy-evaluation.html#cb61-8" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="at">mean_name :=</span> <span class="fu">mean</span>(<span class="sc">!!</span>x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Must use !! and := to set the variable names</span></span>
<span id="cb61-9"><a href="tidy-evaluation.html#cb61-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="at">sum_name  :=</span> <span class="fu">sum</span>(<span class="sc">!!</span>x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-10"><a href="tidy-evaluation.html#cb61-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-11"><a href="tidy-evaluation.html#cb61-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-12"><a href="tidy-evaluation.html#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="tidy-evaluation.html#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">continuous_table</span>(starwars, height)</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã— 2
##   mean_height sum_height
##         &lt;dbl&gt;      &lt;int&gt;
## 1        174.      14123</code></pre>
<p>Alternatively, with the embrace operator and <code>glue</code> to make the var names (supported as of <a href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">rlang 0.4.3</a>).</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="tidy-evaluation.html#cb63-1" aria-hidden="true" tabindex="-1"></a>continuous_table <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x) {</span>
<span id="cb63-2"><a href="tidy-evaluation.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="tidy-evaluation.html#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb63-4"><a href="tidy-evaluation.html#cb63-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;mean_{{ x }}&quot;</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>({{ x }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Must use := to set the variable names</span></span>
<span id="cb63-5"><a href="tidy-evaluation.html#cb63-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;sum_{{ x }}&quot;</span>  <span class="sc">:</span><span class="er">=</span> <span class="fu">sum</span>({{ x }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-6"><a href="tidy-evaluation.html#cb63-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb63-7"><a href="tidy-evaluation.html#cb63-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-8"><a href="tidy-evaluation.html#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="tidy-evaluation.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">continuous_table</span>(starwars, height)</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã— 2
##   mean_height sum_height
##         &lt;dbl&gt;      &lt;int&gt;
## 1        174.      14123</code></pre>
</div>
<div id="the-sym-function" class="section level3" number="3.9.8">
<h3><span class="header-section-number">3.9.8</span> The sym function</h3>
<p>The <code>sym()</code> takes a string as an input and turns it into a symbol.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="tidy-evaluation.html#cb65-1" aria-hidden="true" tabindex="-1"></a>my_col <span class="ot">&lt;-</span> <span class="st">&quot;height&quot;</span></span>
<span id="cb65-2"><a href="tidy-evaluation.html#cb65-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">qq_show</span>(</span>
<span id="cb65-3"><a href="tidy-evaluation.html#cb65-3" aria-hidden="true" tabindex="-1"></a>  starwars <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="tidy-evaluation.html#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb65-5"><a href="tidy-evaluation.html#cb65-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(my_col)</span>
<span id="cb65-6"><a href="tidy-evaluation.html#cb65-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-7"><a href="tidy-evaluation.html#cb65-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## starwars %&gt;% summarize(mean(my_col))</code></pre>
<p>Doesnâ€™t work because R will look for a variable named â€œmy_colâ€ in the data frame â€œstarwarsâ€.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="tidy-evaluation.html#cb67-1" aria-hidden="true" tabindex="-1"></a>my_col <span class="ot">&lt;-</span> <span class="st">&quot;height&quot;</span></span>
<span id="cb67-2"><a href="tidy-evaluation.html#cb67-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">qq_show</span>(</span>
<span id="cb67-3"><a href="tidy-evaluation.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  starwars <span class="sc">%&gt;%</span> </span>
<span id="cb67-4"><a href="tidy-evaluation.html#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb67-5"><a href="tidy-evaluation.html#cb67-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(<span class="sc">!!</span>my_col)</span>
<span id="cb67-6"><a href="tidy-evaluation.html#cb67-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-7"><a href="tidy-evaluation.html#cb67-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## starwars %&gt;% summarize(mean(&quot;height&quot;))</code></pre>
<p>Doesnâ€™t work because R will try to calculate the mean of the character string â€œheightâ€.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="tidy-evaluation.html#cb69-1" aria-hidden="true" tabindex="-1"></a>my_col <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">sym</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb69-2"><a href="tidy-evaluation.html#cb69-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">qq_show</span>(</span>
<span id="cb69-3"><a href="tidy-evaluation.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  starwars <span class="sc">%&gt;%</span> </span>
<span id="cb69-4"><a href="tidy-evaluation.html#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb69-5"><a href="tidy-evaluation.html#cb69-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(<span class="sc">!!</span>my_col)</span>
<span id="cb69-6"><a href="tidy-evaluation.html#cb69-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-7"><a href="tidy-evaluation.html#cb69-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## starwars %&gt;% summarize(mean(height))</code></pre>
<p>This looks like what we would type manually.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="tidy-evaluation.html#cb71-1" aria-hidden="true" tabindex="-1"></a>my_col <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">sym</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb71-2"><a href="tidy-evaluation.html#cb71-2" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb71-3"><a href="tidy-evaluation.html#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb71-4"><a href="tidy-evaluation.html#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(<span class="sc">!!</span>my_col, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-5"><a href="tidy-evaluation.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã— 1
##    mean
##   &lt;dbl&gt;
## 1  174.</code></pre>
<p>And it works as expected</p>
</div>
<div id="the-syms-function" class="section level3" number="3.9.9">
<h3><span class="header-section-number">3.9.9</span> The syms function</h3>
<p>Like <code>sym()</code>, but can convert multiple strings into a list of symbols</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="tidy-evaluation.html#cb73-1" aria-hidden="true" tabindex="-1"></a>my_cols <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">syms</span>(<span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;mass&quot;</span>))</span>
<span id="cb73-2"><a href="tidy-evaluation.html#cb73-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">qq_show</span>(</span>
<span id="cb73-3"><a href="tidy-evaluation.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  starwars <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="tidy-evaluation.html#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb73-5"><a href="tidy-evaluation.html#cb73-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(<span class="sc">!!</span>my_cols)</span>
<span id="cb73-6"><a href="tidy-evaluation.html#cb73-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-7"><a href="tidy-evaluation.html#cb73-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## starwars %&gt;% summarize(mean(&lt;list: height, mass&gt;))</code></pre>
<p>Notice that unquoting with !! returns a list of symbols. To unlist them, we must use the splice operator.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="tidy-evaluation.html#cb75-1" aria-hidden="true" tabindex="-1"></a>my_cols <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">syms</span>(<span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;mass&quot;</span>))</span>
<span id="cb75-2"><a href="tidy-evaluation.html#cb75-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">qq_show</span>(</span>
<span id="cb75-3"><a href="tidy-evaluation.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  starwars <span class="sc">%&gt;%</span> </span>
<span id="cb75-4"><a href="tidy-evaluation.html#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb75-5"><a href="tidy-evaluation.html#cb75-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(<span class="sc">!!!</span>my_cols)</span>
<span id="cb75-6"><a href="tidy-evaluation.html#cb75-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb75-7"><a href="tidy-evaluation.html#cb75-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## starwars %&gt;% summarize(mean(height, mass))</code></pre>
<p>Of course, to make this meaningful we need to map it over height and mass</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="tidy-evaluation.html#cb77-1" aria-hidden="true" tabindex="-1"></a>my_cols <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">syms</span>(<span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;mass&quot;</span>))</span>
<span id="cb77-2"><a href="tidy-evaluation.html#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="tidy-evaluation.html#cb77-3" aria-hidden="true" tabindex="-1"></a>summarise_avg <span class="ot">&lt;-</span> <span class="cf">function</span>(data, col) {</span>
<span id="cb77-4"><a href="tidy-evaluation.html#cb77-4" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">&lt;-</span> <span class="fu">enquo</span>(col)</span>
<span id="cb77-5"><a href="tidy-evaluation.html#cb77-5" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> </span>
<span id="cb77-6"><a href="tidy-evaluation.html#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(<span class="sc">!!</span>col, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb77-7"><a href="tidy-evaluation.html#cb77-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-8"><a href="tidy-evaluation.html#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="tidy-evaluation.html#cb77-9" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(my_cols, summarise_avg, <span class="at">data =</span> starwars)</span>
<span id="cb77-10"><a href="tidy-evaluation.html#cb77-10" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>## # A tibble: 2 Ã— 1
##     avg
##   &lt;dbl&gt;
## 1 174. 
## 2  97.3</code></pre>
</div>
<div id="the-rlang-prounouns" class="section level3" number="3.9.10">
<h3><span class="header-section-number">3.9.10</span> The rlang prounouns</h3>
<p>The <code>rlang</code> package includes two (as of this writing) pronouns: <code>.data</code> and <code>.env</code>. Iâ€™m still slightly confused about what these pronouns <em>are</em> (see <a href="https://stackoverflow.com/questions/63399011/what-is-the-difference-between-and-data">SO post here</a>), but Iâ€™m getting more comfortble with how they are used.</p>
<p>I found a nice example on <a href="https://tinyheero.github.io/2020/03/01/use-data-env-pronouns-tidyverse.html">this blog post</a>.</p>
<p>Because of data masking, <code>filter</code> looks for <code>cyl</code> and <code>carb</code> in <code>mtcars</code> and it returns rows where the value of <code>cyl</code> matches the value of <code>carb</code>.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="tidy-evaluation.html#cb79-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cyl <span class="sc">==</span> carb)</span></code></pre></div>
<pre><code>##                mpg cyl disp  hp drat   wt qsec vs am gear carb
## Ferrari Dino  19.7   6  145 175 3.62 2.77 15.5  0  1    5    6
## Maserati Bora 15.0   8  301 335 3.54 3.57 14.6  0  1    5    8</code></pre>
<p>In this example, because <code>num_cyl</code> doesnâ€™t exist in <code>mtcars</code>, <code>filter</code> will automatically look to the
global environment and return rows where the value of <code>cyl</code> matches the value of <code>num_cyl</code> (a constant 6).</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="tidy-evaluation.html#cb81-1" aria-hidden="true" tabindex="-1"></a>num_cyl <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb81-2"><a href="tidy-evaluation.html#cb81-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cyl <span class="sc">==</span> num_cyl)</span></code></pre></div>
<pre><code>##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</code></pre>
<p>Now, we create an object in the global environment that shares its name with a column in <code>mtcars</code> - <code>carb</code>. Because of data masking (and scoping rules), <code>filter</code> still looks for <code>cyl</code> and <code>carb</code> in <code>mtcars</code> first. Because <code>carb</code> exists in <code>mtcars</code>, <code>filter</code> returns rows where the value of <code>cyl</code> matches the value of <code>mtcars$carb</code> - not the <code>carb</code> object in the global environment.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="tidy-evaluation.html#cb83-1" aria-hidden="true" tabindex="-1"></a>carb <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb83-2"><a href="tidy-evaluation.html#cb83-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cyl <span class="sc">==</span> carb)</span></code></pre></div>
<pre><code>##                mpg cyl disp  hp drat   wt qsec vs am gear carb
## Ferrari Dino  19.7   6  145 175 3.62 2.77 15.5  0  1    5    6
## Maserati Bora 15.0   8  301 335 3.54 3.57 14.6  0  1    5    8</code></pre>
<p>But, we can be more explicit (i.e., safer) about using <code>mtcars$carb</code> with the <code>.data</code> pronoun.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="tidy-evaluation.html#cb85-1" aria-hidden="true" tabindex="-1"></a>carb <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb85-2"><a href="tidy-evaluation.html#cb85-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.data<span class="sc">$</span>cyl <span class="sc">==</span> .data<span class="sc">$</span>carb)</span></code></pre></div>
<pre><code>##                mpg cyl disp  hp drat   wt qsec vs am gear carb
## Ferrari Dino  19.7   6  145 175 3.62 2.77 15.5  0  1    5    6
## Maserati Bora 15.0   8  301 335 3.54 3.57 14.6  0  1    5    8</code></pre>
<p>OR</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="tidy-evaluation.html#cb87-1" aria-hidden="true" tabindex="-1"></a>carb <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb87-2"><a href="tidy-evaluation.html#cb87-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.data[[<span class="st">&quot;cyl&quot;</span>]] <span class="sc">==</span> .data[[<span class="st">&quot;carb&quot;</span>]])</span></code></pre></div>
<pre><code>##                mpg cyl disp  hp drat   wt qsec vs am gear carb
## Ferrari Dino  19.7   6  145 175 3.62 2.77 15.5  0  1    5    6
## Maserati Bora 15.0   8  301 335 3.54 3.57 14.6  0  1    5    8</code></pre>
<p>Similarly, we can use the <code>.env</code> pronoun to explicity instruct <code>filter</code> to compare <code>cyl</code> to the <code>carb</code> object in the global environment.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="tidy-evaluation.html#cb89-1" aria-hidden="true" tabindex="-1"></a>carb <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb89-2"><a href="tidy-evaluation.html#cb89-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.data[[<span class="st">&quot;cyl&quot;</span>]] <span class="sc">==</span> .env[[<span class="st">&quot;carb&quot;</span>]])</span></code></pre></div>
<pre><code>##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</code></pre>
</div>
</div>
<div id="for_loop" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Example: for Loop</h2>
<p>In this example, Iâ€™m creating a table of summary statistics using the Starwars data. The table will compare some simple characteristics of the characters by species.</p>
<p>First, Iâ€™m going to reclassify every character as Human or Not Human</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="tidy-evaluation.html#cb91-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> <span class="fu">mutate</span>(starwars, <span class="at">human =</span> <span class="fu">if_else</span>(species <span class="sc">==</span> <span class="st">&quot;Human&quot;</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>, <span class="cn">NA_character_</span>))</span></code></pre></div>
<p>Now Iâ€™m going to create the table shell</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="tidy-evaluation.html#cb92-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">=</span> <span class="dv">3</span>        <span class="co"># Number of vars</span></span>
<span id="cb92-2"><a href="tidy-evaluation.html#cb92-2" aria-hidden="true" tabindex="-1"></a>rows <span class="ot">=</span> vars <span class="sc">+</span> <span class="dv">1</span> <span class="co"># Additional row for group sample size</span></span>
<span id="cb92-3"><a href="tidy-evaluation.html#cb92-3" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb92-4"><a href="tidy-evaluation.html#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;character&quot;</span>, <span class="at">length =</span> rows),</span>
<span id="cb92-5"><a href="tidy-evaluation.html#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Human =</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;character&quot;</span>, <span class="at">length =</span> rows),</span>
<span id="cb92-6"><a href="tidy-evaluation.html#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Not Human</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;character&quot;</span>, <span class="at">length =</span> rows)</span>
<span id="cb92-7"><a href="tidy-evaluation.html#cb92-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-8"><a href="tidy-evaluation.html#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="tidy-evaluation.html#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co"># N for Human</span></span>
<span id="cb92-10"><a href="tidy-evaluation.html#cb92-10" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb92-11"><a href="tidy-evaluation.html#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;(N = &quot;</span>,</span>
<span id="cb92-12"><a href="tidy-evaluation.html#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(starwars, human <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="sc">%&gt;%</span> <span class="fu">format</span>(<span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>),</span>
<span id="cb92-13"><a href="tidy-evaluation.html#cb92-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;)&quot;</span></span>
<span id="cb92-14"><a href="tidy-evaluation.html#cb92-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-15"><a href="tidy-evaluation.html#cb92-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-16"><a href="tidy-evaluation.html#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="co"># N for Not Human</span></span>
<span id="cb92-17"><a href="tidy-evaluation.html#cb92-17" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb92-18"><a href="tidy-evaluation.html#cb92-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;(N = &quot;</span>,</span>
<span id="cb92-19"><a href="tidy-evaluation.html#cb92-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(starwars, human <span class="sc">==</span> <span class="st">&quot;No&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="sc">%&gt;%</span> <span class="fu">format</span>(<span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>),</span>
<span id="cb92-20"><a href="tidy-evaluation.html#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;)&quot;</span></span>
<span id="cb92-21"><a href="tidy-evaluation.html#cb92-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="tidy-evaluation.html#cb93-1" aria-hidden="true" tabindex="-1"></a>table</span></code></pre></div>
<pre><code>## # A tibble: 4 Ã— 3
##   Variable Human      `Not Human`
##   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      
## 1 &quot;&quot;       &quot;(N = 35)&quot; &quot;(N = 48)&quot; 
## 2 &quot;&quot;       &quot;&quot;         &quot;&quot;         
## 3 &quot;&quot;       &quot;&quot;         &quot;&quot;         
## 4 &quot;&quot;       &quot;&quot;         &quot;&quot;</code></pre>
<p>Finally, Iâ€™ll fill in the table using a for loop. In this case, I just want to compare the mean height, mass, and birth year of humans and non-humans.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="tidy-evaluation.html#cb95-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">quos</span>(height, mass, birth_year)                    <span class="co"># Create vector of quotures for variables of interest</span></span>
<span id="cb95-2"><a href="tidy-evaluation.html#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="tidy-evaluation.html#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)) {</span>
<span id="cb95-4"><a href="tidy-evaluation.html#cb95-4" aria-hidden="true" tabindex="-1"></a>  table[i <span class="sc">+</span> <span class="dv">1</span>, ] <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span>                          <span class="co"># Row of table to receive loop output</span></span>
<span id="cb95-5"><a href="tidy-evaluation.html#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(human)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-6"><a href="tidy-evaluation.html#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(human) <span class="sc">%&gt;%</span> </span>
<span id="cb95-7"><a href="tidy-evaluation.html#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(<span class="sc">!!</span>vars[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="co"># Use !! with vars[[i]]</span></span>
<span id="cb95-8"><a href="tidy-evaluation.html#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Mean =</span> <span class="fu">round</span>(Mean, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">format</span>(<span class="at">nsmall =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-9"><a href="tidy-evaluation.html#cb95-9" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb95-10"><a href="tidy-evaluation.html#cb95-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_from =</span> human,</span>
<span id="cb95-11"><a href="tidy-evaluation.html#cb95-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_from =</span> Mean</span>
<span id="cb95-12"><a href="tidy-evaluation.html#cb95-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb95-13"><a href="tidy-evaluation.html#cb95-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Variable =</span> rlang<span class="sc">::</span><span class="fu">as_name</span>(vars[[i]])) <span class="sc">%&gt;%</span>      <span class="co"># Use as_name to get variable name for first column</span></span>
<span id="cb95-14"><a href="tidy-evaluation.html#cb95-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Variable, Yes, No)</span>
<span id="cb95-15"><a href="tidy-evaluation.html#cb95-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="tidy-evaluation.html#cb96-1" aria-hidden="true" tabindex="-1"></a>table</span></code></pre></div>
<pre><code>## # A tibble: 4 Ã— 3
##   Variable     Human      `Not Human`
##   &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;      
## 1 &quot;&quot;           &quot;(N = 35)&quot; (N = 48)   
## 2 &quot;height&quot;     &quot;176.6&quot;    172.4      
## 3 &quot;mass&quot;       &quot; 82.8&quot;    107.6      
## 4 &quot;birth_year&quot; &quot; 53.4&quot;    139.3</code></pre>
</div>
<div id="functions" class="section level2" number="3.11">
<h2><span class="header-section-number">3.11</span> Example: function</h2>
<p>In this example, Iâ€™m creating a table of summary statistics using the Starwars data. The table will compare some simple characteristics of the characters by species.</p>
<p>First, Iâ€™m going to reclassify every character as Human or Not Human</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="tidy-evaluation.html#cb98-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> <span class="fu">mutate</span>(starwars, <span class="at">human =</span> <span class="fu">if_else</span>(species <span class="sc">==</span> <span class="st">&quot;Human&quot;</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>, <span class="cn">NA_character_</span>))</span></code></pre></div>
<p>Now Iâ€™m going to create the table shell</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="tidy-evaluation.html#cb99-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">=</span> <span class="dv">3</span>        <span class="co"># Number of vars</span></span>
<span id="cb99-2"><a href="tidy-evaluation.html#cb99-2" aria-hidden="true" tabindex="-1"></a>rows <span class="ot">=</span> vars <span class="sc">+</span> <span class="dv">1</span> <span class="co"># Additional row for group sample size</span></span>
<span id="cb99-3"><a href="tidy-evaluation.html#cb99-3" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb99-4"><a href="tidy-evaluation.html#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;character&quot;</span>, <span class="at">length =</span> rows),</span>
<span id="cb99-5"><a href="tidy-evaluation.html#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Human =</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;character&quot;</span>, <span class="at">length =</span> rows),</span>
<span id="cb99-6"><a href="tidy-evaluation.html#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Not Human</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;character&quot;</span>, <span class="at">length =</span> rows)</span>
<span id="cb99-7"><a href="tidy-evaluation.html#cb99-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-8"><a href="tidy-evaluation.html#cb99-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-9"><a href="tidy-evaluation.html#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="co"># N for Human</span></span>
<span id="cb99-10"><a href="tidy-evaluation.html#cb99-10" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb99-11"><a href="tidy-evaluation.html#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;(N = &quot;</span>,</span>
<span id="cb99-12"><a href="tidy-evaluation.html#cb99-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(starwars, human <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="sc">%&gt;%</span> <span class="fu">format</span>(<span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>),</span>
<span id="cb99-13"><a href="tidy-evaluation.html#cb99-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;)&quot;</span></span>
<span id="cb99-14"><a href="tidy-evaluation.html#cb99-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-15"><a href="tidy-evaluation.html#cb99-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-16"><a href="tidy-evaluation.html#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="co"># N for Not Human</span></span>
<span id="cb99-17"><a href="tidy-evaluation.html#cb99-17" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb99-18"><a href="tidy-evaluation.html#cb99-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;(N = &quot;</span>,</span>
<span id="cb99-19"><a href="tidy-evaluation.html#cb99-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(starwars, human <span class="sc">==</span> <span class="st">&quot;No&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="sc">%&gt;%</span> <span class="fu">format</span>(<span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>),</span>
<span id="cb99-20"><a href="tidy-evaluation.html#cb99-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;)&quot;</span></span>
<span id="cb99-21"><a href="tidy-evaluation.html#cb99-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="tidy-evaluation.html#cb100-1" aria-hidden="true" tabindex="-1"></a>table</span></code></pre></div>
<pre><code>## # A tibble: 4 Ã— 3
##   Variable Human      `Not Human`
##   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      
## 1 &quot;&quot;       &quot;(N = 35)&quot; &quot;(N = 48)&quot; 
## 2 &quot;&quot;       &quot;&quot;         &quot;&quot;         
## 3 &quot;&quot;       &quot;&quot;         &quot;&quot;         
## 4 &quot;&quot;       &quot;&quot;         &quot;&quot;</code></pre>
<p>Finally, Iâ€™ll fill in the table using a user-defined function. In this case, I just want to compare the mean height, mass, and birth year of humans and non-humans.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="tidy-evaluation.html#cb102-1" aria-hidden="true" tabindex="-1"></a>my_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(df, vars) {</span>
<span id="cb102-2"><a href="tidy-evaluation.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb102-3"><a href="tidy-evaluation.html#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(human)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-4"><a href="tidy-evaluation.html#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(human) <span class="sc">%&gt;%</span> </span>
<span id="cb102-5"><a href="tidy-evaluation.html#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate means</span></span>
<span id="cb102-6"><a href="tidy-evaluation.html#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb102-7"><a href="tidy-evaluation.html#cb102-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(</span>
<span id="cb102-8"><a href="tidy-evaluation.html#cb102-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">.cols  =</span> {{ vars }},</span>
<span id="cb102-9"><a href="tidy-evaluation.html#cb102-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">.fns   =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb102-10"><a href="tidy-evaluation.html#cb102-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb102-11"><a href="tidy-evaluation.html#cb102-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-12"><a href="tidy-evaluation.html#cb102-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format the results</span></span>
<span id="cb102-13"><a href="tidy-evaluation.html#cb102-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb102-14"><a href="tidy-evaluation.html#cb102-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(</span>
<span id="cb102-15"><a href="tidy-evaluation.html#cb102-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb102-16"><a href="tidy-evaluation.html#cb102-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">.fns  =</span> <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">format</span>(<span class="at">nsmall =</span> <span class="dv">1</span>)</span>
<span id="cb102-17"><a href="tidy-evaluation.html#cb102-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb102-18"><a href="tidy-evaluation.html#cb102-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-19"><a href="tidy-evaluation.html#cb102-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Restructure results to match the summary table</span></span>
<span id="cb102-20"><a href="tidy-evaluation.html#cb102-20" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb102-21"><a href="tidy-evaluation.html#cb102-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_from =</span> human,</span>
<span id="cb102-22"><a href="tidy-evaluation.html#cb102-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_from =</span> {{ vars }},</span>
<span id="cb102-23"><a href="tidy-evaluation.html#cb102-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_sep =</span> <span class="st">&quot;-&quot;</span></span>
<span id="cb102-24"><a href="tidy-evaluation.html#cb102-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb102-25"><a href="tidy-evaluation.html#cb102-25" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb102-26"><a href="tidy-evaluation.html#cb102-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb102-27"><a href="tidy-evaluation.html#cb102-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;Variable&quot;</span>, <span class="st">&quot;.value&quot;</span>),</span>
<span id="cb102-28"><a href="tidy-evaluation.html#cb102-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_sep =</span> <span class="st">&quot;-&quot;</span></span>
<span id="cb102-29"><a href="tidy-evaluation.html#cb102-29" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb102-30"><a href="tidy-evaluation.html#cb102-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder and rename the columns to match the output table</span></span>
<span id="cb102-31"><a href="tidy-evaluation.html#cb102-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Variable, <span class="at">Human =</span> Yes, <span class="st">`</span><span class="at">Not Human</span><span class="st">`</span> <span class="ot">=</span> No)</span>
<span id="cb102-32"><a href="tidy-evaluation.html#cb102-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-33"><a href="tidy-evaluation.html#cb102-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-34"><a href="tidy-evaluation.html#cb102-34" aria-hidden="true" tabindex="-1"></a><span class="co"># For testing</span></span>
<span id="cb102-35"><a href="tidy-evaluation.html#cb102-35" aria-hidden="true" tabindex="-1"></a><span class="co"># my_stats(starwars, c(height, mass, birth_year))</span></span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="tidy-evaluation.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Or if you prefer to use ...</span></span>
<span id="cb103-2"><a href="tidy-evaluation.html#cb103-2" aria-hidden="true" tabindex="-1"></a>my_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(df, ...) {</span>
<span id="cb103-3"><a href="tidy-evaluation.html#cb103-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-4"><a href="tidy-evaluation.html#cb103-4" aria-hidden="true" tabindex="-1"></a>  vars <span class="ot">&lt;-</span> <span class="fu">enquos</span>(...)</span>
<span id="cb103-5"><a href="tidy-evaluation.html#cb103-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-6"><a href="tidy-evaluation.html#cb103-6" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb103-7"><a href="tidy-evaluation.html#cb103-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(human)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-8"><a href="tidy-evaluation.html#cb103-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(human) <span class="sc">%&gt;%</span> </span>
<span id="cb103-9"><a href="tidy-evaluation.html#cb103-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate means</span></span>
<span id="cb103-10"><a href="tidy-evaluation.html#cb103-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb103-11"><a href="tidy-evaluation.html#cb103-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(</span>
<span id="cb103-12"><a href="tidy-evaluation.html#cb103-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">.cols  =</span> <span class="fu">c</span>(<span class="sc">!!!</span>vars),</span>
<span id="cb103-13"><a href="tidy-evaluation.html#cb103-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">.fns   =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb103-14"><a href="tidy-evaluation.html#cb103-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb103-15"><a href="tidy-evaluation.html#cb103-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-16"><a href="tidy-evaluation.html#cb103-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-17"><a href="tidy-evaluation.html#cb103-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-18"><a href="tidy-evaluation.html#cb103-18" aria-hidden="true" tabindex="-1"></a><span class="co"># For testing</span></span>
<span id="cb103-19"><a href="tidy-evaluation.html#cb103-19" aria-hidden="true" tabindex="-1"></a><span class="co"># my_stats(starwars, height, mass, birth_year)</span></span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="tidy-evaluation.html#cb104-1" aria-hidden="true" tabindex="-1"></a>table <span class="sc">%&gt;%</span> </span>
<span id="cb104-2"><a href="tidy-evaluation.html#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb104-3"><a href="tidy-evaluation.html#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_stats</span>(starwars, <span class="fu">c</span>(height, mass, birth_year))</span>
<span id="cb104-4"><a href="tidy-evaluation.html#cb104-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 7 Ã— 3
##   Variable     Human      `Not Human`
##   &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;      
## 1 &quot;&quot;           &quot;(N = 35)&quot; &quot;(N = 48)&quot; 
## 2 &quot;&quot;           &quot;&quot;         &quot;&quot;         
## 3 &quot;&quot;           &quot;&quot;         &quot;&quot;         
## 4 &quot;&quot;           &quot;&quot;         &quot;&quot;         
## 5 &quot;height&quot;     &quot;176.6&quot;    &quot;172.4&quot;    
## 6 &quot;mass&quot;       &quot; 82.8&quot;    &quot;107.6&quot;    
## 7 &quot;birth_year&quot; &quot; 53.4&quot;    &quot;139.3&quot;</code></pre>
</div>
<div id="nesting" class="section level2" number="3.12">
<h2><span class="header-section-number">3.12</span> Nesting functions with data masking</h2>
<p>One place where the embrace operator can get you in trouble is with nested functions. I ran into this problem when writing the codebook package. In the example below, notice that the name of column we want to analyze (i.e., <code>height</code>) is passed to the <code>x</code> argument of the <code>cb_add_summary_stats()</code> function as a tring (i.e., â€œheightâ€), and then to the <code>x</code> argument of the <code>cb_summary_stats_numeric()</code> function, and then to the <code>mean()</code> function inside of the <code>summarise()</code> function. Along the way, the association between <code>x</code> and <code>height</code> is lost.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="tidy-evaluation.html#cb106-1" aria-hidden="true" tabindex="-1"></a>codebook <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb106-2"><a href="tidy-evaluation.html#cb106-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="st">&quot;height&quot;</span></span>
<span id="cb106-3"><a href="tidy-evaluation.html#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cb_add_summary_stats</span>(df, x)</span>
<span id="cb106-4"><a href="tidy-evaluation.html#cb106-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-5"><a href="tidy-evaluation.html#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="tidy-evaluation.html#cb106-6" aria-hidden="true" tabindex="-1"></a>cb_add_summary_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x) {</span>
<span id="cb106-7"><a href="tidy-evaluation.html#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cb_summary_stats_numeric</span>(df, x)</span>
<span id="cb106-8"><a href="tidy-evaluation.html#cb106-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-9"><a href="tidy-evaluation.html#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="tidy-evaluation.html#cb106-10" aria-hidden="true" tabindex="-1"></a>cb_summary_stats_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x) {</span>
<span id="cb106-11"><a href="tidy-evaluation.html#cb106-11" aria-hidden="true" tabindex="-1"></a>  summary <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb106-12"><a href="tidy-evaluation.html#cb106-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>({{ x }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb106-13"><a href="tidy-evaluation.html#cb106-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-14"><a href="tidy-evaluation.html#cb106-14" aria-hidden="true" tabindex="-1"></a>  summary</span>
<span id="cb106-15"><a href="tidy-evaluation.html#cb106-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-16"><a href="tidy-evaluation.html#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="tidy-evaluation.html#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="fu">codebook</span>(study)</span></code></pre></div>
<pre><code>## Warning in mean.default(~x, na.rm = TRUE): argument is not numeric or logical:
## returning NA</code></pre>
<pre><code>## # A tibble: 1 Ã— 1
##    mean
##   &lt;dbl&gt;
## 1    NA</code></pre>
<p>Letâ€™s take a look at what R sees in <code>cb_summary_stats_numeric()</code>.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="tidy-evaluation.html#cb109-1" aria-hidden="true" tabindex="-1"></a>cb_summary_stats_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x) {</span>
<span id="cb109-2"><a href="tidy-evaluation.html#cb109-2" aria-hidden="true" tabindex="-1"></a>  rlang<span class="sc">::</span><span class="fu">qq_show</span>(</span>
<span id="cb109-3"><a href="tidy-evaluation.html#cb109-3" aria-hidden="true" tabindex="-1"></a>    summary <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb109-4"><a href="tidy-evaluation.html#cb109-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>({{ x }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb109-5"><a href="tidy-evaluation.html#cb109-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb109-6"><a href="tidy-evaluation.html#cb109-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb109-7"><a href="tidy-evaluation.html#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="tidy-evaluation.html#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="fu">codebook</span>(study)</span></code></pre></div>
<pre><code>## summary &lt;- df %&gt;% summarise(mean = mean(^x, na.rm = TRUE))</code></pre>
<p>But, what we want R to see is <code>height</code> instead of <code>x</code>. The simplest fix is to use the <code>.data</code> pronoun.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="tidy-evaluation.html#cb111-1" aria-hidden="true" tabindex="-1"></a>codebook <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb111-2"><a href="tidy-evaluation.html#cb111-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="st">&quot;height&quot;</span></span>
<span id="cb111-3"><a href="tidy-evaluation.html#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cb_add_summary_stats</span>(df, x)</span>
<span id="cb111-4"><a href="tidy-evaluation.html#cb111-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-5"><a href="tidy-evaluation.html#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="tidy-evaluation.html#cb111-6" aria-hidden="true" tabindex="-1"></a>cb_add_summary_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x) {</span>
<span id="cb111-7"><a href="tidy-evaluation.html#cb111-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cb_summary_stats_numeric</span>(df, x)</span>
<span id="cb111-8"><a href="tidy-evaluation.html#cb111-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-9"><a href="tidy-evaluation.html#cb111-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-10"><a href="tidy-evaluation.html#cb111-10" aria-hidden="true" tabindex="-1"></a>cb_summary_stats_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x) {</span>
<span id="cb111-11"><a href="tidy-evaluation.html#cb111-11" aria-hidden="true" tabindex="-1"></a>  summary <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb111-12"><a href="tidy-evaluation.html#cb111-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(.data[[x]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb111-13"><a href="tidy-evaluation.html#cb111-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-14"><a href="tidy-evaluation.html#cb111-14" aria-hidden="true" tabindex="-1"></a>  summary</span>
<span id="cb111-15"><a href="tidy-evaluation.html#cb111-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-16"><a href="tidy-evaluation.html#cb111-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-17"><a href="tidy-evaluation.html#cb111-17" aria-hidden="true" tabindex="-1"></a><span class="fu">codebook</span>(study)</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã— 1
##    mean
##   &lt;dbl&gt;
## 1  72.3</code></pre>
</div>
<div id="purrr" class="section level2" number="3.13">
<h2><span class="header-section-number">3.13</span> Using purrr</h2>
<p>I have a situation that Iâ€™m a little confused about. I think if I could understand the contrived situation below, then I could figure out my issue.</p>
<p>Essentially, when I use map(x, function(x) { !!x }) with tidyeval I get the result that I expect. When I try to use the purrr shortcut, i.e., map(x, ~ { !!. }) I get an error. I donâ€™t understand why. If anybody has insight that they care to share, I would really appreciate it!</p>
<p>A reprex is below:</p>
<p>This works as expected:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="tidy-evaluation.html#cb113-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">quos</span>(gender, species)</span>
<span id="cb113-2"><a href="tidy-evaluation.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="tidy-evaluation.html#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">map_df</span>(vars, <span class="cf">function</span>(x){</span>
<span id="cb113-4"><a href="tidy-evaluation.html#cb113-4" aria-hidden="true" tabindex="-1"></a>  starwars <span class="sc">%&gt;%</span></span>
<span id="cb113-5"><a href="tidy-evaluation.html#cb113-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span> x) <span class="sc">%&gt;%</span></span>
<span id="cb113-6"><a href="tidy-evaluation.html#cb113-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb113-7"><a href="tidy-evaluation.html#cb113-7" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## # A tibble: 41 Ã— 3
##    gender    `mean(height, na.rm = TRUE)` species 
##    &lt;chr&gt;                            &lt;dbl&gt; &lt;chr&gt;   
##  1 feminine                          165. &lt;NA&gt;    
##  2 masculine                         177. &lt;NA&gt;    
##  3 &lt;NA&gt;                              181. &lt;NA&gt;    
##  4 &lt;NA&gt;                               79  Aleena  
##  5 &lt;NA&gt;                              198  Besalisk
##  6 &lt;NA&gt;                              198  Cerean  
##  7 &lt;NA&gt;                              196  Chagrian
##  8 &lt;NA&gt;                              168  Clawdite
##  9 &lt;NA&gt;                              131. Droid   
## 10 &lt;NA&gt;                              112  Dug     
## # â€¦ with 31 more rows</code></pre>
<p>Iâ€™m not sure why this doesnâ€™t work:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="tidy-evaluation.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vars &lt;- quos(gender, species)</span></span>
<span id="cb115-2"><a href="tidy-evaluation.html#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb115-3"><a href="tidy-evaluation.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co"># map_df(vars, ~ {</span></span>
<span id="cb115-4"><a href="tidy-evaluation.html#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   starwars %&gt;%</span></span>
<span id="cb115-5"><a href="tidy-evaluation.html#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     group_by(!! .) %&gt;%</span></span>
<span id="cb115-6"><a href="tidy-evaluation.html#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     summarise(mean(height, na.rm = TRUE))</span></span>
<span id="cb115-7"><a href="tidy-evaluation.html#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span></code></pre></div>
<p>The answer is to use â€œ.xâ€ instead of â€œ.â€:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="tidy-evaluation.html#cb116-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">quos</span>(gender, species)</span>
<span id="cb116-2"><a href="tidy-evaluation.html#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="tidy-evaluation.html#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="fu">map_df</span>(vars, <span class="sc">~</span> {</span>
<span id="cb116-4"><a href="tidy-evaluation.html#cb116-4" aria-hidden="true" tabindex="-1"></a>  starwars <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="tidy-evaluation.html#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span> .x) <span class="sc">%&gt;%</span></span>
<span id="cb116-6"><a href="tidy-evaluation.html#cb116-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb116-7"><a href="tidy-evaluation.html#cb116-7" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## # A tibble: 41 Ã— 3
##    gender    `mean(height, na.rm = TRUE)` species 
##    &lt;chr&gt;                            &lt;dbl&gt; &lt;chr&gt;   
##  1 feminine                          165. &lt;NA&gt;    
##  2 masculine                         177. &lt;NA&gt;    
##  3 &lt;NA&gt;                              181. &lt;NA&gt;    
##  4 &lt;NA&gt;                               79  Aleena  
##  5 &lt;NA&gt;                              198  Besalisk
##  6 &lt;NA&gt;                              198  Cerean  
##  7 &lt;NA&gt;                              196  Chagrian
##  8 &lt;NA&gt;                              168  Clawdite
##  9 &lt;NA&gt;                              131. Droid   
## 10 &lt;NA&gt;                              112  Dug     
## # â€¦ with 31 more rows</code></pre>
<p>However, Iâ€™m not entirely sure why. When I have more time, Iâ€™d like to figure this out.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="tidy-evaluation.html#cb118-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">quos</span>(gender, species)</span>
<span id="cb118-2"><a href="tidy-evaluation.html#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="tidy-evaluation.html#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(vars, <span class="cf">function</span>(x) {</span>
<span id="cb118-4"><a href="tidy-evaluation.html#cb118-4" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb118-5"><a href="tidy-evaluation.html#cb118-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## [[1]]
## &lt;quosure&gt;
## expr: ^gender
## env:  global
## 
## [[2]]
## &lt;quosure&gt;
## expr: ^species
## env:  global</code></pre>
</div>
<div id="quirks" class="section level2" number="3.14">
<h2><span class="header-section-number">3.14</span> Other Quirks and Lessons Learned</h2>
<div id="when-doesnt-work" class="section level3" number="3.14.1">
<h3><span class="header-section-number">3.14.1</span> When !! doesnâ€™t work</h3>
<p>Iâ€™ve noticed that using <code>!!</code> doesnâ€™t always work. At this point, Iâ€™m not exactly sure the rules related to when it works and when it doesnâ€™t work, but I do want to write down some examples and fixes.</p>
<p>Sometimes itâ€™s my fault:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="tidy-evaluation.html#cb120-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var, ...) {</span>
<span id="cb120-2"><a href="tidy-evaluation.html#cb120-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)</span>
<span id="cb120-3"><a href="tidy-evaluation.html#cb120-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-4"><a href="tidy-evaluation.html#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="sc">!!</span>x) <span class="co"># This doesn&#39;t work - need to associate the quoture variable with its data frame</span></span>
<span id="cb120-5"><a href="tidy-evaluation.html#cb120-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-6"><a href="tidy-evaluation.html#cb120-6" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(hair_color)</span></code></pre></div>
<pre><code>## Error in `print()`:
## ! Quosures can only be unquoted within a quasiquotation context.
## 
## # Bad: list(!!myquosure)
## 
## # Good: dplyr::mutate(data, !!myquosure)</code></pre>
<p>Fix:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="tidy-evaluation.html#cb122-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var, ...) {</span>
<span id="cb122-2"><a href="tidy-evaluation.html#cb122-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)</span>
<span id="cb122-3"><a href="tidy-evaluation.html#cb122-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb122-4"><a href="tidy-evaluation.html#cb122-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>x) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb122-5"><a href="tidy-evaluation.html#cb122-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb122-6"><a href="tidy-evaluation.html#cb122-6" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(hair_color)</span></code></pre></div>
<pre><code>## # A tibble: 87 Ã— 1
##    hair_color   
##    &lt;chr&gt;        
##  1 blond        
##  2 &lt;NA&gt;         
##  3 &lt;NA&gt;         
##  4 none         
##  5 brown        
##  6 brown, grey  
##  7 brown        
##  8 &lt;NA&gt;         
##  9 black        
## 10 auburn, white
## # â€¦ with 77 more rows</code></pre>
</div>
<div id="unquoting-inside-non-dplyr-functions" class="section level3" number="3.14.2">
<h3><span class="header-section-number">3.14.2</span> Unquoting inside non-dplyr functions</h3>
<p>Iâ€™ve notice some weirdness when trying to unquote quotures inside functions that are inside dplyr functions. For example, if_else inside of mutate.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="tidy-evaluation.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This didn&#39;t used to work, but it does now</span></span>
<span id="cb124-2"><a href="tidy-evaluation.html#cb124-2" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb124-3"><a href="tidy-evaluation.html#cb124-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)</span>
<span id="cb124-4"><a href="tidy-evaluation.html#cb124-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb124-5"><a href="tidy-evaluation.html#cb124-5" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb124-6"><a href="tidy-evaluation.html#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hair_color =</span> <span class="fu">if_else</span>(<span class="sc">!!</span>x <span class="sc">==</span> <span class="st">&quot;blond&quot;</span>, <span class="st">&quot;blonde&quot;</span>, <span class="sc">!!</span>x))</span>
<span id="cb124-7"><a href="tidy-evaluation.html#cb124-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb124-8"><a href="tidy-evaluation.html#cb124-8" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(hair_color)</span></code></pre></div>
<pre><code>## # A tibble: 87 Ã— 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sâ€¦    172    77 blonde      fair       blue            19   male  mascuâ€¦
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascuâ€¦
##  3 R2-D2       96    32 &lt;NA&gt;        white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth â€¦    202   136 none        white      yellow          41.9 male  mascuâ€¦
##  5 Leia Oâ€¦    150    49 brown       light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Lâ€¦    178   120 brown, grey light      blue            52   male  mascuâ€¦
##  7 Beru Wâ€¦    165    75 brown       light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascuâ€¦
##  9 Biggs â€¦    183    84 black       light      brown           24   male  mascuâ€¦
## 10 Obi-Waâ€¦    182    77 auburn, whâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â€¦ with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, human &lt;chr&gt;</code></pre>
</div>
<div id="using-a-quoture-to-create-variable-name-in-mutate" class="section level3" number="3.14.3">
<h3><span class="header-section-number">3.14.3</span> Using a quoture to create variable name in mutate</h3>
<p>Additionally, sometimes there is some trickiness to naming (or overwriting) a variable name inside of mutate.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="tidy-evaluation.html#cb126-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb126-2"><a href="tidy-evaluation.html#cb126-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)</span>
<span id="cb126-3"><a href="tidy-evaluation.html#cb126-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-4"><a href="tidy-evaluation.html#cb126-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb126-5"><a href="tidy-evaluation.html#cb126-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">x =</span> <span class="fu">if_else</span>(<span class="sc">!!</span>x <span class="sc">==</span> <span class="st">&quot;blond&quot;</span>, <span class="st">&quot;blonde&quot;</span>, <span class="sc">!!</span>x))</span>
<span id="cb126-6"><a href="tidy-evaluation.html#cb126-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb126-7"><a href="tidy-evaluation.html#cb126-7" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(hair_color)</span></code></pre></div>
<pre><code>## Error: &lt;text&gt;:5:16: unexpected &#39;=&#39;
## 4:   df %&gt;% 
## 5:     mutate(!!x =
##                   ^</code></pre>
<p>Fix:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="tidy-evaluation.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This didn&#39;t used to work, but it does now</span></span>
<span id="cb128-2"><a href="tidy-evaluation.html#cb128-2" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb128-3"><a href="tidy-evaluation.html#cb128-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)</span>
<span id="cb128-4"><a href="tidy-evaluation.html#cb128-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-5"><a href="tidy-evaluation.html#cb128-5" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb128-6"><a href="tidy-evaluation.html#cb128-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">x :=</span> <span class="fu">if_else</span>(<span class="sc">!!</span>x <span class="sc">==</span> <span class="st">&quot;blond&quot;</span>, <span class="st">&quot;blonde&quot;</span>, <span class="sc">!!</span>x))</span>
<span id="cb128-7"><a href="tidy-evaluation.html#cb128-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-8"><a href="tidy-evaluation.html#cb128-8" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(hair_color)</span></code></pre></div>
<pre><code>## # A tibble: 87 Ã— 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sâ€¦    172    77 blonde      fair       blue            19   male  mascuâ€¦
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascuâ€¦
##  3 R2-D2       96    32 &lt;NA&gt;        white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth â€¦    202   136 none        white      yellow          41.9 male  mascuâ€¦
##  5 Leia Oâ€¦    150    49 brown       light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Lâ€¦    178   120 brown, grey light      blue            52   male  mascuâ€¦
##  7 Beru Wâ€¦    165    75 brown       light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascuâ€¦
##  9 Biggs â€¦    183    84 black       light      brown           24   male  mascuâ€¦
## 10 Obi-Waâ€¦    182    77 auburn, whâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â€¦ with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, human &lt;chr&gt;</code></pre>
<p>Fix 2:</p>
<p>Must have !! in front of as_name(). Must use := instead of =.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="tidy-evaluation.html#cb130-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb130-2"><a href="tidy-evaluation.html#cb130-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)</span>
<span id="cb130-3"><a href="tidy-evaluation.html#cb130-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-4"><a href="tidy-evaluation.html#cb130-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb130-5"><a href="tidy-evaluation.html#cb130-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">as_name</span>(x) <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>(<span class="sc">!!</span>x <span class="sc">==</span> <span class="st">&quot;blond&quot;</span>, <span class="st">&quot;blonde&quot;</span>, <span class="sc">!!</span>x))</span>
<span id="cb130-6"><a href="tidy-evaluation.html#cb130-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb130-7"><a href="tidy-evaluation.html#cb130-7" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(hair_color)</span></code></pre></div>
<pre><code>## # A tibble: 87 Ã— 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sâ€¦    172    77 blonde      fair       blue            19   male  mascuâ€¦
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascuâ€¦
##  3 R2-D2       96    32 &lt;NA&gt;        white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth â€¦    202   136 none        white      yellow          41.9 male  mascuâ€¦
##  5 Leia Oâ€¦    150    49 brown       light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Lâ€¦    178   120 brown, grey light      blue            52   male  mascuâ€¦
##  7 Beru Wâ€¦    165    75 brown       light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascuâ€¦
##  9 Biggs â€¦    183    84 black       light      brown           24   male  mascuâ€¦
## 10 Obi-Waâ€¦    182    77 auburn, whâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â€¦ with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, human &lt;chr&gt;</code></pre>
<p>Fix 3:</p>
<p>Alternatively, use the embrace operator and <code>glue</code> to make the var names (supported as of <a href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">rlang 0.4.3</a>).</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="tidy-evaluation.html#cb132-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb132-2"><a href="tidy-evaluation.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb132-3"><a href="tidy-evaluation.html#cb132-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb132-4"><a href="tidy-evaluation.html#cb132-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;{{ var }}&quot;</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>({{ var }} <span class="sc">==</span> <span class="st">&quot;blond&quot;</span>, <span class="st">&quot;blonde&quot;</span>, {{ var }}),</span>
<span id="cb132-5"><a href="tidy-evaluation.html#cb132-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Even create a new variable</span></span>
<span id="cb132-6"><a href="tidy-evaluation.html#cb132-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;new_{{ var }}&quot;</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>({{ var }} <span class="sc">==</span> <span class="st">&quot;blond&quot;</span>, <span class="st">&quot;blonde&quot;</span>, {{ var }})</span>
<span id="cb132-7"><a href="tidy-evaluation.html#cb132-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb132-8"><a href="tidy-evaluation.html#cb132-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-9"><a href="tidy-evaluation.html#cb132-9" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(hair_color)</span></code></pre></div>
<pre><code>## # A tibble: 87 Ã— 16
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sâ€¦    172    77 blonde      fair       blue            19   male  mascuâ€¦
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascuâ€¦
##  3 R2-D2       96    32 &lt;NA&gt;        white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth â€¦    202   136 none        white      yellow          41.9 male  mascuâ€¦
##  5 Leia Oâ€¦    150    49 brown       light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Lâ€¦    178   120 brown, grey light      blue            52   male  mascuâ€¦
##  7 Beru Wâ€¦    165    75 brown       light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascuâ€¦
##  9 Biggs â€¦    183    84 black       light      brown           24   male  mascuâ€¦
## 10 Obi-Waâ€¦    182    77 auburn, whâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â€¦ with 77 more rows, and 7 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, human &lt;chr&gt;,
## #   new_hair_color &lt;chr&gt;</code></pre>
</div>
<div id="using-a-quoture-to-turn-a-variable-name-into-a-constant-value" class="section level3" number="3.14.4">
<h3><span class="header-section-number">3.14.4</span> Using a quoture to turn a variable name into a constant value</h3>
<p>When Iâ€™m looping over many variables, I often want to create a variable in my output called â€œcharacteristicâ€ or â€œvariableâ€ that captures the current variable name as a value.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="tidy-evaluation.html#cb134-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb134-2"><a href="tidy-evaluation.html#cb134-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)                              <span class="co"># Make sure to use enquo here</span></span>
<span id="cb134-3"><a href="tidy-evaluation.html#cb134-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-4"><a href="tidy-evaluation.html#cb134-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb134-5"><a href="tidy-evaluation.html#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb134-6"><a href="tidy-evaluation.html#cb134-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">Mean =</span> <span class="fu">mean</span>(<span class="sc">!!</span>x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb134-7"><a href="tidy-evaluation.html#cb134-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb134-8"><a href="tidy-evaluation.html#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Characteristic =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">as_name</span>(x)) <span class="sc">%&gt;%</span> <span class="co"># Make sure to use !!as_name()</span></span>
<span id="cb134-9"><a href="tidy-evaluation.html#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Characteristic, Mean)</span>
<span id="cb134-10"><a href="tidy-evaluation.html#cb134-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-11"><a href="tidy-evaluation.html#cb134-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-12"><a href="tidy-evaluation.html#cb134-12" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(height)</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã— 2
##   Characteristic  Mean
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 height          174.</code></pre>
<p>Alternatively:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="tidy-evaluation.html#cb136-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb136-2"><a href="tidy-evaluation.html#cb136-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb136-3"><a href="tidy-evaluation.html#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb136-4"><a href="tidy-evaluation.html#cb136-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">Mean =</span> <span class="fu">mean</span>({{ var }}, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb136-5"><a href="tidy-evaluation.html#cb136-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb136-6"><a href="tidy-evaluation.html#cb136-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Characteristic =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">as_name</span>(<span class="fu">enquo</span>(var))) <span class="sc">%&gt;%</span></span>
<span id="cb136-7"><a href="tidy-evaluation.html#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Characteristic, Mean)</span>
<span id="cb136-8"><a href="tidy-evaluation.html#cb136-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb136-9"><a href="tidy-evaluation.html#cb136-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-10"><a href="tidy-evaluation.html#cb136-10" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(height)</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã— 2
##   Characteristic  Mean
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 height          174.</code></pre>
</div>
<div id="convert-a-string-to-a-quoture" class="section level3" number="3.14.5">
<h3><span class="header-section-number">3.14.5</span> Convert a string to a quoture</h3>
<p>Here are some useful websites:</p>
<p><a href="https://github.com/tidyverse/rlang/issues/116" class="uri">https://github.com/tidyverse/rlang/issues/116</a></p>
<p><a href="https://stackoverflow.com/questions/27975124/pass-arguments-to-dplyr-functions/44594223#44594223" class="uri">https://stackoverflow.com/questions/27975124/pass-arguments-to-dplyr-functions/44594223#44594223</a></p>
<p><a href="https://stackoverflow.com/questions/44593596/how-to-pass-strings-denoting-expressions-to-dplyr-0-7-verbs/44593617#44593617" class="uri">https://stackoverflow.com/questions/44593596/how-to-pass-strings-denoting-expressions-to-dplyr-0-7-verbs/44593617#44593617</a></p>
<p>Sometimes, I want to pass a variable name as a string to a function. It then needs to be converted to a quoture for evaluation.</p>
<div id="simple-example---now-this-works" class="section level4" number="3.14.5.1">
<h4><span class="header-section-number">3.14.5.1</span> Simple example - Now this works</h4>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="tidy-evaluation.html#cb138-1" aria-hidden="true" tabindex="-1"></a>my_col <span class="ot">&lt;-</span> <span class="fu">names</span>(starwars[<span class="dv">2</span>]) <span class="co"># Have a variable name as a quoted string</span></span>
<span id="cb138-2"><a href="tidy-evaluation.html#cb138-2" aria-hidden="true" tabindex="-1"></a>my_col <span class="ot">&lt;-</span> <span class="st">&quot;mass&quot;</span></span>
<span id="cb138-3"><a href="tidy-evaluation.html#cb138-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>my_col) <span class="co"># Now this works</span></span></code></pre></div>
<pre><code>## # A tibble: 87 Ã— 1
##     mass
##    &lt;dbl&gt;
##  1    77
##  2    75
##  3    32
##  4   136
##  5    49
##  6   120
##  7    75
##  8    32
##  9    84
## 10    77
## # â€¦ with 77 more rows</code></pre>
</div>
<div id="when-the-string-is-created-inside-the-function" class="section level4" number="3.14.5.2">
<h4><span class="header-section-number">3.14.5.2</span> When the string is created inside the function</h4>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="tidy-evaluation.html#cb140-1" aria-hidden="true" tabindex="-1"></a>starwars<span class="sc">$</span>height_squared <span class="ot">&lt;-</span> starwars<span class="sc">$</span>height<span class="sc">**</span><span class="dv">2</span></span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="tidy-evaluation.html#cb141-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb141-2"><a href="tidy-evaluation.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-3"><a href="tidy-evaluation.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)  <span class="co"># First, turn var without the suffix into a quoture - must be first</span></span>
<span id="cb141-4"><a href="tidy-evaluation.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  squared <span class="ot">&lt;-</span> <span class="fu">paste</span>(rlang<span class="sc">::</span><span class="fu">as_name</span>(x), <span class="st">&quot;squared&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="co"># Must use quo_name()</span></span>
<span id="cb141-5"><a href="tidy-evaluation.html#cb141-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-6"><a href="tidy-evaluation.html#cb141-6" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb141-7"><a href="tidy-evaluation.html#cb141-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb141-8"><a href="tidy-evaluation.html#cb141-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">Mean =</span> <span class="fu">mean</span>(<span class="sc">!!</span>squared, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb141-9"><a href="tidy-evaluation.html#cb141-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb141-10"><a href="tidy-evaluation.html#cb141-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb141-11"><a href="tidy-evaluation.html#cb141-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-12"><a href="tidy-evaluation.html#cb141-12" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(height)</span></code></pre></div>
<pre><code>## Warning in mean.default(&quot;height_squared&quot;, na.rm = TRUE): argument is not numeric
## or logical: returning NA</code></pre>
<pre><code>## # A tibble: 1 Ã— 1
##    Mean
##   &lt;dbl&gt;
## 1    NA</code></pre>
<p>Fix (Method prefered by Hadley and Lionel):</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="tidy-evaluation.html#cb144-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb144-2"><a href="tidy-evaluation.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-3"><a href="tidy-evaluation.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">enquo</span>(var)  <span class="co"># First, turn var without the suffix into a quoture - must be first</span></span>
<span id="cb144-4"><a href="tidy-evaluation.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  squared <span class="ot">&lt;-</span> <span class="fu">paste</span>(rlang<span class="sc">::</span><span class="fu">as_name</span>(x), <span class="st">&quot;squared&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="co"># Must use as_name()</span></span>
<span id="cb144-5"><a href="tidy-evaluation.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  squared <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">sym</span>(squared) <span class="co"># Wrap with sym()</span></span>
<span id="cb144-6"><a href="tidy-evaluation.html#cb144-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-7"><a href="tidy-evaluation.html#cb144-7" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb144-8"><a href="tidy-evaluation.html#cb144-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb144-9"><a href="tidy-evaluation.html#cb144-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">Mean =</span> <span class="fu">mean</span>(<span class="sc">!!</span>squared, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb144-10"><a href="tidy-evaluation.html#cb144-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb144-11"><a href="tidy-evaluation.html#cb144-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-12"><a href="tidy-evaluation.html#cb144-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-13"><a href="tidy-evaluation.html#cb144-13" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">example</span>(height)</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã— 1
##     Mean
##    &lt;dbl&gt;
## 1 31595.</code></pre>
</div>
<div id="grouping-by-all-columns-in-the-data-frame" class="section level4" number="3.14.5.3">
<h4><span class="header-section-number">3.14.5.3</span> Grouping by all columns in the data frame</h4>
<p>Ran into this situation while checking for duplicate rows in APS data (DETECT pilot test)</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="tidy-evaluation.html#cb146-1" aria-hidden="true" tabindex="-1"></a>starwars_2 <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>films, <span class="sc">-</span>vehicles, <span class="sc">-</span>starships) <span class="co"># Remove list columns</span></span>
<span id="cb146-2"><a href="tidy-evaluation.html#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="tidy-evaluation.html#cb146-3" aria-hidden="true" tabindex="-1"></a>starwars_2 <span class="sc">%&gt;%</span> </span>
<span id="cb146-4"><a href="tidy-evaluation.html#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">names</span>(starwars)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-5"><a href="tidy-evaluation.html#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-6"><a href="tidy-evaluation.html#cb146-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb146-7"><a href="tidy-evaluation.html#cb146-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb146-8"><a href="tidy-evaluation.html#cb146-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n)</span></code></pre></div>
<pre><code>## Error in `group_by()`:
## ! Problem adding computed columns.
## Caused by error in `mutate()`:
## ! Problem while computing `..1 = names(starwars)`.
## x `..1` must be size 87 or 1, not 16.</code></pre>
<p>Fix: In this case, we could have used the built-in group_by_all</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="tidy-evaluation.html#cb148-1" aria-hidden="true" tabindex="-1"></a>starwars_2 <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>films, <span class="sc">-</span>vehicles, <span class="sc">-</span>starships) <span class="co"># Remove list columns</span></span>
<span id="cb148-2"><a href="tidy-evaluation.html#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="tidy-evaluation.html#cb148-3" aria-hidden="true" tabindex="-1"></a>starwars_2 <span class="sc">%&gt;%</span> </span>
<span id="cb148-4"><a href="tidy-evaluation.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_all</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb148-5"><a href="tidy-evaluation.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-6"><a href="tidy-evaluation.html#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb148-7"><a href="tidy-evaluation.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb148-8"><a href="tidy-evaluation.html#cb148-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n)</span></code></pre></div>
<pre><code>## # A tibble: 0 Ã— 1
## # â€¦ with 1 variable: n &lt;int&gt;</code></pre>
<p>And, there are no duplicates.</p>
<p>Another, more general solution for using all column names is:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="tidy-evaluation.html#cb150-1" aria-hidden="true" tabindex="-1"></a>starwars_2 <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>films, <span class="sc">-</span>vehicles, <span class="sc">-</span>starships) <span class="co"># Remove list columns</span></span>
<span id="cb150-2"><a href="tidy-evaluation.html#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="tidy-evaluation.html#cb150-3" aria-hidden="true" tabindex="-1"></a>my_cols <span class="ot">&lt;-</span> starwars_2 <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="sc">%&gt;%</span> rlang<span class="sc">::</span><span class="fu">syms</span>()</span>
<span id="cb150-4"><a href="tidy-evaluation.html#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="tidy-evaluation.html#cb150-5" aria-hidden="true" tabindex="-1"></a>starwars_2 <span class="sc">%&gt;%</span> </span>
<span id="cb150-6"><a href="tidy-evaluation.html#cb150-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!!</span>my_cols) <span class="sc">%&gt;%</span> <span class="co"># Remember to use splice &#39;!!!&#39;</span></span>
<span id="cb150-7"><a href="tidy-evaluation.html#cb150-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb150-8"><a href="tidy-evaluation.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb150-9"><a href="tidy-evaluation.html#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb150-10"><a href="tidy-evaluation.html#cb150-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n)</span></code></pre></div>
<pre><code>## # A tibble: 0 Ã— 1
## # â€¦ with 1 variable: n &lt;int&gt;</code></pre>
<p><a href="#top">top</a></p>
</div>
</div>
</div>
<div id="example-i-created-for-steph-yap" class="section level2" number="3.15">
<h2><span class="header-section-number">3.15</span> Example I created for Steph Yap</h2>
<p>Need to clean this up, but I donâ€™t have time now.</p>
<p><strong>Here is a worked example using some toy data</strong></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="tidy-evaluation.html#cb152-1" aria-hidden="true" tabindex="-1"></a>aps_cleaned <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb152-2"><a href="tidy-evaluation.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">case_num =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb152-3"><a href="tidy-evaluation.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valid_physical_neglect =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb152-4"><a href="tidy-evaluation.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">valid_sexual_abuse =</span> <span class="dv">0</span></span>
<span id="cb152-5"><a href="tidy-evaluation.html#cb152-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb152-6"><a href="tidy-evaluation.html#cb152-6" aria-hidden="true" tabindex="-1"></a>discrepancies_valid_physical_neglect <span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb152-7"><a href="tidy-evaluation.html#cb152-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">case_num =</span> <span class="dv">1</span>,</span>
<span id="cb152-8"><a href="tidy-evaluation.html#cb152-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">valid_physical_neglect =</span> <span class="dv">1</span></span>
<span id="cb152-9"><a href="tidy-evaluation.html#cb152-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb152-10"><a href="tidy-evaluation.html#cb152-10" aria-hidden="true" tabindex="-1"></a>discrepancies_valid_sexual_abuse <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb152-11"><a href="tidy-evaluation.html#cb152-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">case_num =</span> <span class="dv">3</span>,</span>
<span id="cb152-12"><a href="tidy-evaluation.html#cb152-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">valid_sexual_abuse =</span> <span class="dv">1</span></span>
<span id="cb152-13"><a href="tidy-evaluation.html#cb152-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Create the function</strong></p>
<p>Here is a refernce to help with the tidy evaluation stuff: <a href="https://dplyr.tidyverse.org/articles/programming.html" class="uri">https://dplyr.tidyverse.org/articles/programming.html</a></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="tidy-evaluation.html#cb153-1" aria-hidden="true" tabindex="-1"></a>join_aps <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">.data =</span> aps_cleaned, join_df, valid_col) {</span>
<span id="cb153-2"><a href="tidy-evaluation.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create column names to use in the code below</span></span>
<span id="cb153-3"><a href="tidy-evaluation.html#cb153-3" aria-hidden="true" tabindex="-1"></a>  col_x <span class="ot">&lt;-</span> <span class="fu">sym</span>(<span class="fu">paste0</span>(<span class="fu">quo_name</span>(<span class="fu">enquo</span>(valid_col)), <span class="st">&quot;.x&quot;</span>))</span>
<span id="cb153-4"><a href="tidy-evaluation.html#cb153-4" aria-hidden="true" tabindex="-1"></a>  col_y <span class="ot">&lt;-</span> <span class="fu">sym</span>(<span class="fu">paste0</span>(<span class="fu">quo_name</span>(<span class="fu">enquo</span>(valid_col)), <span class="st">&quot;.y&quot;</span>))</span>
<span id="cb153-5"><a href="tidy-evaluation.html#cb153-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb153-6"><a href="tidy-evaluation.html#cb153-6" aria-hidden="true" tabindex="-1"></a>  .data <span class="sc">%&gt;%</span> </span>
<span id="cb153-7"><a href="tidy-evaluation.html#cb153-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(join_df, <span class="at">by =</span> <span class="st">&quot;case_num&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb153-8"><a href="tidy-evaluation.html#cb153-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb153-9"><a href="tidy-evaluation.html#cb153-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;{{valid_col}}_cleaned&quot;</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>(</span>
<span id="cb153-10"><a href="tidy-evaluation.html#cb153-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>({{ col_y }}), {{ col_x }}, {{ col_y }}</span>
<span id="cb153-11"><a href="tidy-evaluation.html#cb153-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb153-12"><a href="tidy-evaluation.html#cb153-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb153-13"><a href="tidy-evaluation.html#cb153-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Test function</strong></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="tidy-evaluation.html#cb154-1" aria-hidden="true" tabindex="-1"></a>aps_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="tidy-evaluation.html#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">join_aps</span>(discrepancies_valid_physical_neglect, valid_physical_neglect)</span></code></pre></div>
<!--
Clean up and add session info
-->

</div>
</div>




</div>




</div>
            </section>

          </div>
        </div>
      </div>
<a href="creating-rmd-templates.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="arranging-columns-with-across.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
